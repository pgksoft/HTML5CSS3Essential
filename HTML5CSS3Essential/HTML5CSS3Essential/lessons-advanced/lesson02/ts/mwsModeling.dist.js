!function(e){var t={};function i(s){if(t[s])return t[s].exports;var a=t[s]={i:s,l:!1,exports:{}};return e[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(s,a,function(t){return e[t]}.bind(null,a));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=3)}([function(e,t,i){"use strict";i.d(t,"c",(function(){return s})),i.d(t,"e",(function(){return a})),i.d(t,"d",(function(){return r})),i.d(t,"b",(function(){return n})),i.d(t,"a",(function(){return o}));var s,a;!function(e){e[e.LeftToRight=1]="LeftToRight",e[e.TopToBottom=2]="TopToBottom",e[e.LeftTopToBottomRight=3]="LeftTopToBottomRight",e[e.RightTopToLeftBottom=4]="RightTopToLeftBottom"}(s||(s={})),function(e){e[e.Centre=1]="Centre",e[e.LeftRight=2]="LeftRight",e[e.RightLeft=3]="RightLeft",e[e.TopBottom=4]="TopBottom",e[e.BottomTop=5]="BottomTop"}(a||(a={}));class r{constructor(){this.colorScheme=new n}GetGradientProperties(){this.direction=o.instance.RandomInt(1,4),this.colorScheme=new n;let e,t,i=o.instance.RandomInt(5,15);for(let s=0;s<i;s++)e=s/i,t=o.instance.randomColor,this.colorScheme.Add([e,t]);return e=1,t=o.instance.randomColor,this.colorScheme.Add([e,t]),this}}class n{constructor(){this._scheme=[]}get list(){return this._scheme}Add(e){this._scheme.push(e)}Clear(){this._scheme.length=0}}class h{constructor(e,t,i,s,a,r){this._oneX=0,this._oneY=0,this._oneR=0,this._twoX=0,this._twoY=0,this._twoR=0,this._oneX=e,this._oneY=t,this._oneR=i,this._twoX=s,this._twoY=a,this._twoR=r}get oneX(){return this._oneX}set oneX(e){this._oneX=e}get oneY(){return this._oneY}set oneY(e){this._oneY=e}get oneR(){return this._oneR}set oneR(e){this._oneR=e}get twoX(){return this._twoX}set twoX(e){this._twoX=e}get twoY(){return this._twoY}set twoY(e){this._twoY=e}get twoR(){return this._twoR}set twoR(e){this._twoR=e}}let o=(()=>{class e{constructor(){this._mapColors=new Map([["Aliceblue","#f0f8ff"],["Antiquewhite","#FAEBD7"],["Aqua","#00FFFF"],["Aquamarine","#7FFFD4"],["Azure","#F0FFFF"],["Beige","#F5F5DC"],["Bisque","#FFE4C4"],["Black","#000000"],["Blanchedalmond","#FFEBCD"],["Blue","#0000ff"],["Blueviolet","#8A2BE2"],["Brown","#A52A2A"],["Burlywood","#DEB887"],["Cadetblue","#5F9EA0"],["Chartreuse","#7FFF00"],["Chocolate","#D2691E"],["Coral","#FF7F50"],["Cornflowerblue","#6495ED"],["Cornsilk","#FFF8DC"],["Crimson","#DC143C"],["Cyan","#00FFFF"],["Darkblue","#00008B"],["Darkcyan","#008B8B"],["Darkgoldenrod","#B8860B"],["Darkgray","#A9A9A9"],["Darkgreen","#006400"],["Darkkhaki","#BDB76B"],["Darkmagenta","#8B008B"],["Darkolivegreen","#556B2F"],["Darkorange","#FF8C00"],["Darkorchid","#9932CC"],["Darkred","#8B0000"],["Darksalmon","#E9967A"],["Darkseagreen","#8FBC8B"],["Darkslateblue","#483D8B"],["Darkslategray","#2F4F4F"],["Darkturquoise","#00CED1"],["Darkviolet","#9400D3"],["Deeppink","#FF1493"],["Deepskyblue","#00BFFF"],["Dimgray","#696969"],["Dodgerblue","#1E90FF"],["Firebrick","#B22222"],["Floralwhite","#FFFAF0"],["Forestgreen","#228B22"],["Fuchsia","#FF00FF"],["Gainsboro","#DCDCDC"],["Ghostwhite","#F8F8FF"],["Gold","#FFD700"],["Goldenrod","#DAA520"],["Gray","#808080"],["Green","#008000"],["Greenyellow","#ADFF2F"],["Honeydew","#F0FFF0"],["Hotpink","#FF69B4"],["Indianred","#CD5C5C"],["Indigo","#4B0082"],["Ivory","#FFFFF0"],["Khaki","#F0E68C"],["Lavender","#E6E6FA"],["Lavenderblush","#FFF0F5"],["Lawngreen","#7CFC00"],["Lemonchiffon","#FFFACD"],["Lightblue","#ADD8E6"],["Lightcoral","#F08080"],["Lightcyan","#E0FFFF"],["Lightgoldenrod","#EEDD82"],["Lightgoldenrodyellow","#FAFAD2"],["Lightgray","#D3D3D3"],["Lightgreen","#90EE90"],["Lightpink","#FFB6C1"],["Lightsalmon","#FFA07A"],["Lightseagreen","#20B2AA"],["Lightskyblue","#87CEFA"],["Lightslateblue","#8470FF"],["Lightslategray","#778899"],["Lightsteelblue","#B0C4DE"],["Lightyellow","#FFFFE0"],["Lime","#00FF00"],["Limegreen","#32CD32"],["Linen","#FAF0E6"],["Magenta","#FF00FF"],["Maroon","#800000"],["Mediumaquamarine","#66CDAA"],["Mediumblue","#0000CD"],["Mediumorchid","#BA55D3"],["Mediumpurple","#9370DB"],["Mediumseagreen","#3CB371"],["Mediumslateblue","#7B68EE"],["Mediumspringgreen","#00FA9A"],["Mediumturquoise","#48D1CC"],["Mediumvioletred","#C71585"],["Midnightblue","#191970"],["Mintcream","#F5FFFA"],["Mistyrose","#FFE4E1"],["Moccasin","#FFE4B5"],["Navajowhite","#FFDEAD"],["Navy","#000080"],["Navyblue","#A0B0E0"],["Oldlace","#FDF5E6"],["Olive","#808000"],["Olivedrab","#6B8E23"],["Orange","#FFA500"],["Orangered","#FF4500"],["Orchid","#DA70D6"],["Palegoldenrod","#EEE8AA"],["Palegreen","#98FB98"],["Paleturquoise","#AFEEEE"],["Palevioletred","#DB7093"],["Papayawhip","#FFEFD5"],["Peachpuff","#FFDAB9"],["Peru","#CD853F"],["Pink","#FFC0CB"],["Plum","#DDA0DD"],["Powderblue","#B0E0E6"],["Purple","#800080"],["Red","#FF0000"],["Rosybrown","#BC8F8F"],["Royalblue","#4169E1"],["Saddlebrown","#8B4513"],["Salmon","#FA8072"],["Sandybrown","#F4A460"],["Seagreen","#2E8B57"],["Seashell","#FFF5EE"],["Sienna","#A0522D"],["Silver","#C0C0C0"],["Skyblue","#87CEEB"],["Slateblue","#6A5ACD"],["Slategray","#708090"],["Snow","#FFFAFA"],["Springgreen","#00FF7F"],["Steelblue","#4682B4"],["Tan","#D2B48C"],["Teal","#008080"],["Thistle","#D8BFD8"],["Tomato","#FF6347"],["Turquoise","#40E0D0"],["Violet","#EE82EE"],["Violetred","#D02090"],["Wheat","#F5DEB3"],["White","#FFFFFF"],["Whitesmoke","#F5F5F5"],["Yellow","#FFFF00"],["Yellowgreen","#9ACD32"]]),this._minLayersGradient=5,this._maxLayersGradient=15}static get instance(){return e._instance||(this._instance=new e),this._instance}get mapColors(){return this._mapColors}get randomColor(){let e,t=this.RandomInt(1,this._mapColors.size),i=0;for(let s of this._mapColors.keys())if(i++,i===t){e=this._mapColors.get(s);break}return e}get minLayersGradient(){return this._minLayersGradient}set minLayersGradient(e){this._minLayersGradient=e}get maxLayersGradient(){return this._maxLayersGradient}set maxLayersGradient(e){this._maxLayersGradient=e}CreateColorScheme(t=[]){let i=new n;if(0==t.length){let t,s,a=this.RandomInt(this.minLayersGradient,this.maxLayersGradient);for(let r=0;r<a;r++)t=r/a,s=e.instance.randomColor,i.Add([t,s]);t=1,s=e.instance.randomColor,i.Add([t,s])}else t.forEach(e=>{i.Add(e)});return i}FillSchemeColor(e,t=null){t||(t=this.randomColor),e.beginPath(),e.rect(0,0,e.canvas.width,e.canvas.height),e.fillStyle=t,e.fill()}FillSchemeLineGradient(e,t){e.beginPath(),e.rect(0,0,e.canvas.width,e.canvas.height),e.fillStyle=this.RestoreFillRectLineGradient(e,0,0,e.canvas.width,e.canvas.height,t),e.fill()}FillSchemeRadialGradient(e,t){e.beginPath(),e.rect(0,0,e.canvas.width,e.canvas.height),e.fillStyle=this.GetFillRectRadialGradient(e,this.GetRadialParams(0,0,e.canvas.width,e.canvas.height,t.radialDirection),t.colorScheme),e.fill()}FillLineGradient(e,t){let i;i=this.GetLinerGradient(t,e,0,0,e.canvas.width,e.canvas.height),this.GetLinerGradientColorScheme(i),e.fillStyle=i,e.fillRect(0,0,e.canvas.width,e.canvas.height)}FillRectRadialGradiant(e,t,i,s,a,r,n,h,o,l,d,m){let c=e.createRadialGradient(r,n,h,o,l,d);m.list.forEach(e=>{c.addColorStop(e[0],e[1])}),e.fillStyle=c,e.fillRect(t,i,s,a)}GetFillRectRadialGradient(e,t,i){let s=e.createRadialGradient(t.oneX,t.oneY,t.oneR,t.twoX,t.twoY,t.twoR);return i.list.forEach(e=>{s.addColorStop(e[0],e[1])}),s}GetRadialParams(e,t,i,s,r){let n=new h(0,0,0,0,0,0);switch(r){case a.Centre:n.oneR=Math.ceil(Math.min(i,s)/30),n.oneX=Math.ceil(e+i/2),n.oneY=Math.ceil(t+s/2),n.twoR=Math.ceil(.9*Math.min(i,s)),n.twoX=Math.ceil(e+i/2),n.twoY=Math.ceil(t+s/2);break;case a.LeftRight:n.oneR=Math.ceil(s/2),n.oneX=Math.ceil(e+2*n.oneR/3),n.oneY=Math.ceil(t+s/2),n.twoR=n.oneR,n.twoX=Math.ceil(e+i+n.twoR),n.twoY=Math.ceil(t+s/2);break;case a.RightLeft:n.oneR=Math.ceil(s/2),n.oneX=Math.ceil(e+i-2*n.oneR/3),n.oneY=Math.ceil(t+s/2),n.twoR=n.oneR,n.twoX=Math.ceil(e-n.twoR),n.twoY=Math.ceil(t+s/2);break;case a.TopBottom:n.oneR=Math.ceil(i/2),n.oneX=Math.ceil(e+i/2),n.oneY=Math.ceil(t+2*n.oneR/3),n.twoR=n.oneR,n.twoX=Math.ceil(e+i/2),n.twoY=Math.ceil(t+s+n.oneR);break;case a.BottomTop:n.oneR=Math.ceil(i/2),n.oneX=Math.ceil(e+i/2),n.oneY=Math.ceil(t+s-2*n.oneR/3),n.twoR=n.oneR,n.twoX=Math.ceil(e+i/2),n.twoY=Math.ceil(t-n.oneR)}return n}GetFillBoxLineGradient(e,t,i,s,a){let r;return a.direction=this.RandomInt(1,4),r=this.GetLinerGradient(a.direction,e,t,i,s,s),a.colorScheme=this.GetLinerGradientColorScheme(r),r}GetFillRectLineGradient(e,t,i,s,a,r){let n;return r.direction=this.RandomInt(1,4),n=this.GetLinerGradient(r.direction,e,t,i,s,a),r.colorScheme=this.GetLinerGradientColorScheme(n),n}RestoreFillBoxLineGradient(e,t,i,s,a){let r;r=this.GetLinerGradient(a.direction,e,t,i,s,s);for(let e of a.colorScheme.list)r.addColorStop(e[0],e[1]);return r}RestoreFillRectLineGradient(e,t,i,s,a,r){let n;n=this.GetLinerGradient(r.direction,e,t,i,s,a);for(let e of r.colorScheme.list)n.addColorStop(e[0],e[1]);return n}RandomInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}GetLinerGradient(e,t,i,a,r,n){return e===s.LeftToRight?t.createLinearGradient(i,a,i,a+n):e===s.TopToBottom?t.createLinearGradient(i,a,i+r,a):e===s.LeftTopToBottomRight?t.createLinearGradient(i,a,i+n,a+r):e===s.RightTopToLeftBottom?t.createLinearGradient(i,a+r,i+n,0):t.createLinearGradient(i,a,i,a+n)}GetLinerGradientColorScheme(e){let t,i,s=new n,a=this.RandomInt(this.minLayersGradient,this.maxLayersGradient);for(let r=0;r<a;r++)t=r/a,i=this.randomColor,s.Add([t,i]),e.addColorStop(t,i);return t=1,i=this.randomColor,s.Add([t,i]),e.addColorStop(t,i),s}}return e._instance=void 0,e})()},function(e,t,i){"use strict";var s,a;i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return n})),String.prototype.padStart||(String.prototype.padStart=function(e,t){return e>>=0,t=String(t||" "),this.length>e?String(this):((e-=this.length)>t.length&&(t+=t.repeat(e/t.length)),t.slice(0,e)+String(this))}),function(e){e[e.Add=0]="Add",e[e.Edit=1]="Edit",e[e.Reproduce=2]="Reproduce",e[e.Info=3]="Info",e[e.Remove=4]="Remove",e[e.Find=5]="Find",e[e.ClearFind=6]="ClearFind"}(s||(s={})),function(e){e[e.Disable=0]="Disable",e[e.Enable=1]="Enable"}(a||(a={}));let r=e=>"block"===e.style.display||"block"===window.getComputedStyle(e,null).display||"flex"===e.style.display||"flex"===window.getComputedStyle(e,null).display,n=e=>{(window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(e){window.setTimeout(e,300)})(e)};(()=>{class e{constructor(e,t,i,s,a){this._modal=e,this._header=t,this._content=i,this._yes=s,this._no=a}static get instance(){return this._instance}static Create(t,i,s,a,r){e._instance||(this._instance=new e(t,i,s,a,r))}get nameEventDeleteConfirm(){return"modalConfirm-delete-confirm"}get nameEventDeleteRefuse(){return"modalConfirm-delete-refuse"}get nameEventSureConfirm(){return"modalConfirm-sure-confirm"}get nameEventSureRefuse(){return"modalConfirm-sure-refuse"}get nameEventCaution(){return"modalConfirm-caution"}get eventDeleteConfirm(){return new CustomEvent(this.nameEventDeleteConfirm,{bubbles:!0})}get eventDeleteRefuse(){return new CustomEvent(this.nameEventDeleteRefuse,{bubbles:!0})}get eventCaution(){return new CustomEvent(this.nameEventCaution,{bubbles:!0})}OpenConfirmDelete(e,t=null){this._header.innerText="Подтвердите удаление",this._content.innerText=e,this.SetButtonDefault(),t?(this._yes.onclick=()=>{document.dispatchEvent(new CustomEvent(this.nameEventDeleteConfirm,{bubbles:!0,detail:{resolve:t}}))},this._no.onclick=()=>{document.dispatchEvent(new CustomEvent(this.nameEventDeleteRefuse,{bubbles:!0,detail:{resolve:t}}))}):(this._yes.onclick=()=>{document.dispatchEvent(this.eventDeleteConfirm)},this._no.onclick=()=>{document.dispatchEvent(this.eventDeleteRefuse)}),this._modal.style.display="block"}OpenSure(e){this._header.innerText="Are you sure?",this._content.innerText="Please confirm the action",this.SetButtonDefault(),this._yes.onclick=()=>{document.dispatchEvent(new CustomEvent(this.nameEventSureConfirm,{bubbles:!0,detail:{resolve:e}}))},this._no.onclick=()=>{document.dispatchEvent(new CustomEvent(this.nameEventSureRefuse,{bubbles:!0,detail:{resolve:e}}))},this._modal.style.display="block"}OpenCaution(e){this._header.innerText="!!! Внимание",this._content.innerText=e,this.SetButtonCaution(),this._yes.onclick=()=>{document.dispatchEvent(this.eventCaution)},this._modal.style.display="block"}SetButtonDefault(){this.ToVisibilityBtn(this._yes),this.ToVisibilityBtn(this._no),this._yes.innerText="Confirm",this._no.innerText="Refuse"}SetButtonCaution(){this.ToVisibilityBtn(this._yes),this.ToUnVisibilityBtn(this._no),this._yes.innerText="OK"}ToVisibilityBtn(e){e.style.position="static",e.style.visibility="visible"}ToUnVisibilityBtn(e){e.style.position="absolute ",e.style.visibility="hidden"}}e._instance=void 0})();(()=>{class e{constructor(e,t,i,s,a){this._name=e,this._typeAction=t,this._state=i,this._action=s,this._context=a}get name(){return this._name}get typeAction(){return this._typeAction}get state(){return this._state}set state(e){this._state=e,document.dispatchEvent(this.eventChangeState)}get isEnabled(){return this.state==a.Enable}get eventChangeState(){return new CustomEvent(e.eventNameChangeState,{bubbles:!0,detail:{command:this}})}Execute(){this.isEnabled&&this._action.call(this._context)}}e.eventNameChangeState="command-change-state"})()},,function(e,t,i){"use strict";i.r(t);var s=i(1),a=i(0);const r=new Map([["300 x 150",300],["600 x 300",600],["900 x 450",900],["1200 x 600",1200],["1600 x 800",1600],["1900 x 950",1900],["2560 x 1280",2560],["3200 x 1600",3200],["4800 x 2400",4800],["5600 x 2800",5600]]),n=new Map([["Любая",0],["Цветная",1],["Линейный градиент",2],["Радиальный градиент",3]]);class h{constructor(){this.app="MultiSystemWindowModeling-Params"}}class o{}class l{constructor(){this.x=0,this.y=0,this.width=0,this.height=0}}class d{constructor(){this.x=0,this.y=0,this.kind=["",-1],this.serialNumber=0,this.isSelected=!1,this.width=0,this.widthOriginal=0,this.waveLength=0,this.waveAmplitude=0,this.wavePeriod=0,this.waveShading=0,this.height=0,this.heightOriginal=0,this.borderWidth=0,this.aspectRatio=0,this.country=["",""],this.insideX=0,this.insideY=0,this.insideWidth=0,this.insideHeight=0,this.url="",this.headerHeight=0,this.fillType=n.entries().next().value,this.colorFill="",this.colorStroke="",this.borderLinearDirection=a.c.LeftToRight,this.insideLinearDirection=a.c.LeftToRight,this.borderRadialDirection=a.e.Centre,this.insideRadialDirection=a.e.Centre,this.borderColorScheme=[],this.insideColorScheme=[],this.fontsize=10,this.isMaximize=!1,this.isMinimize=!1}}class m{constructor(){this._fill=Array.from(n.entries()).find(e=>"Цветная"===e[0]),this._scale=Array.from(r.entries()).find(e=>1900===e[1]),this._isOffScreenCanvas=!1,this._isTrackProportionsAreaMotion=!0,this._isTranslucentModal=!1}get fill(){return this._fill}get scale(){return this._scale}get isOffScreenCanvas(){return this._isOffScreenCanvas}get isTrackProportionsAreaMotion(){return this._isTrackProportionsAreaMotion}get isTranslucentModal(){return this._isTranslucentModal}}let c=(()=>{class e{constructor(){this._default=new m,this._fill=this._default.fill,this._scale=this._default.scale,this._isTrackProportionsAreaMotion=this._default.isTrackProportionsAreaMotion,this._isOffScreenCanvas=this._default.isOffScreenCanvas,this._isTranslucentModal=this._default.isTranslucentModal,this._localKey=new h,this._localParms=new o,this._wPropStored=new d,this._canvasCoordinates=[0,0],this._serialNumberTracking=0,this._switchSerialNumber=0,this._sizeResizingZone=0,this._nameEventFillChange="mwsFillChange",this._nameEventScaleChange="mwsScaleChange",this._nameEventIsOffScreenCanvas="mwsClick-IsOffScreenCanvas",this._nameEventIsTrackProportionsAreaMotion="mwsClick-IsTrackProportionsAreaMotion",this._nameEventIsTranslucent="mwsClick-IsTranslucentModal",this._nameEventCanvasCoordinates="mwsCanvas-Coordinates",this._nameEventSerialNumberTracking="mwsCanvas-SerialNumberTracking",this._nameEventWPropStored="mwsWindow-Properties-Stored",this._nameEventWPropStoredWidthChanged="mwsWindow-Properties-Stored-Width-Changed",this._nameEventWPropStoredHeightChanged="mwsWindow-Properties-Stored-Height-Changed",this._nameEventWPropStoredLengthWaveChanged="mwsWindow-Properties-Stored-Length-Wave-Changed",this._nameEventWPropStoredAmplitudeWaveChanged="mwsWindow-Properties-Stored-Amplitude-Wave-Changed",this._nameEventWPropStoredPeriodWaveChanged="mwsWindow-Properties-Stored-Period-Wave-Changed",this._nameEventWPropStoredShadingWaveChanged="mwsWindow-Properties-Stored-Shading-Wave-Changed",this._localParms.fill=this._fill,this._localParms.scale=this._scale,this._localParms.isOffScreenCanvas=this._isOffScreenCanvas,this._localParms.isTrackProportionsAreaMotion=this._isTrackProportionsAreaMotion,this._localParms.isTranslucentModal=this._isTranslucentModal,this.Load(),this.DefineEvents()}get nameEventFillChange(){return this._nameEventFillChange}get nameEventScaleChange(){return this._nameEventScaleChange}get nameEventIsOffScreenCanvas(){return this._nameEventIsOffScreenCanvas}get nameEventIsTrackProportionsAreaMotion(){return this._nameEventIsTrackProportionsAreaMotion}get nameEventIsTranslucent(){return this._nameEventIsTranslucent}get nameEventCanvasCoordinates(){return this._nameEventCanvasCoordinates}get nameEventSerialNumberTracking(){return this._nameEventSerialNumberTracking}get nameEventWPropStored(){return this._nameEventWPropStored}get nameEventWPropStoredWidthChanged(){return this._nameEventWPropStoredWidthChanged}get nameEventWPropStoredHeightChanged(){return this._nameEventWPropStoredHeightChanged}get nameEventWPropStoredLengthWaveChanged(){return this._nameEventWPropStoredLengthWaveChanged}get nameEventWPropStoredAmplitudeWaveChanged(){return this._nameEventWPropStoredAmplitudeWaveChanged}get nameEventWPropStoredPeriodWaveChanged(){return this._nameEventWPropStoredPeriodWaveChanged}get nameEventWPropStoredShadingWaveChanged(){return this._nameEventWPropStoredShadingWaveChanged}static get instance(){return e._instance||(e._instance=new e),e._instance}get default(){return this._default}get fill(){return this._fill}set fill(e){this._fill=e,this._localParms.fill=this.fill,this.wPropStored.fillType=e,this.Save(),document.dispatchEvent(new CustomEvent(this.nameEventFillChange,{bubbles:!0,detail:{value:e}}))}get scale(){return this._scale}set scale(e){this._scale=e,this._localParms.scale=this.scale,this.Save(),document.dispatchEvent(new CustomEvent(this.nameEventScaleChange,{bubbles:!0,detail:{value:e}}))}get isOffScreenCanvas(){return this._isOffScreenCanvas}set isOffScreenCanvas(e){this._isOffScreenCanvas=e,this._localParms.isOffScreenCanvas=this.isOffScreenCanvas,this.Save(),document.dispatchEvent(new CustomEvent(this._nameEventIsOffScreenCanvas,{bubbles:!0,detail:{value:e}}))}get isTrackProportionsAreaMotion(){return this._isTrackProportionsAreaMotion}set isTrackProportionsAreaMotion(e){this._isTrackProportionsAreaMotion=e,this._localParms.isTrackProportionsAreaMotion=this.isTrackProportionsAreaMotion,this.Save(),document.dispatchEvent(new CustomEvent(this.nameEventIsTrackProportionsAreaMotion,{bubbles:!0,detail:{value:e}}))}get isTranslucentModal(){return this._isTranslucentModal}set isTranslucentModal(e){this._isTranslucentModal=e,this._localParms.isTranslucentModal=this.isTranslucentModal,this.Save(),document.dispatchEvent(new CustomEvent(this.nameEventIsTranslucent,{bubbles:!0,detail:{value:e}}))}get canvasCoordinates(){return this._canvasCoordinates}set canvasCoordinates(e){this._canvasCoordinates=e,document.dispatchEvent(new CustomEvent(this.nameEventCanvasCoordinates,{bubbles:!0,detail:{value:e,event:this.nameEventCanvasCoordinates}}))}get serialNumberTracking(){return this._serialNumberTracking}set serialNumberTracking(e){this._serialNumberTracking=e,document.dispatchEvent(new CustomEvent(this.nameEventSerialNumberTracking,{bubbles:!0,detail:{value:e,event:this.nameEventSerialNumberTracking}}))}get switchSerialNumber(){return this._switchSerialNumber}set switchSerialNumber(e){this._switchSerialNumber=e}get sizeResizingZone(){return this._sizeResizingZone}set sizeResizingZone(e){this._sizeResizingZone=e}get wPropStored(){return this._wPropStored}set wPropStored(e){this._wPropStored=e,document.dispatchEvent(new CustomEvent(this.nameEventWPropStored,{bubbles:!0,detail:{value:e,event:this.nameEventWPropStored}}))}DefineEvents(){document.addEventListener(this.nameEventWPropStoredWidthChanged,e=>{this.Save()},!1),document.addEventListener(this.nameEventWPropStoredHeightChanged,e=>{this.Save()},!1),document.addEventListener(this.nameEventWPropStoredLengthWaveChanged,e=>{this.Save()},!1),document.addEventListener(this.nameEventWPropStoredAmplitudeWaveChanged,e=>{this.Save()},!1),document.addEventListener(this.nameEventWPropStoredPeriodWaveChanged,e=>{this.Save()},!1),document.addEventListener(this.nameEventWPropStoredShadingWaveChanged,e=>{this.Save()},!1)}Save(){localStorage.setItem(JSON.stringify(this._localKey),JSON.stringify(this._localParms))}Load(){localStorage.getItem(JSON.stringify(this._localKey))&&(this._localParms=JSON.parse(localStorage.getItem(JSON.stringify(this._localKey))),this._scale=this._localParms.scale,this._isTrackProportionsAreaMotion=this._localParms.isTrackProportionsAreaMotion,this._isTranslucentModal=this._localParms.isTranslucentModal)}}return e._instance=void 0,e})(),u=(()=>{class e{}return e.waveLenghthMin=5,e.waveLenghthMax=100,e.waveAmplitudeMin=1,e.waveAmplitudeMax=100,e.wavePeriodMin=1,e.wavePeriodMax=999,e.waveShadingMin=1,e.waveShadingMax=200,e.figureWidthMin=100,e.figureWidthMax=5e3,e.figureHeightMin=50,e.figureHeightMax=3e3,e})();const w=new Map([["point",0],["figure",1],["rectangle",2],["circle",3],["flag",4]]);class g{constructor(e,t,i){this.name=e,this.url=t,this.aspectRatio=i}}const S=[new g("Belarus","../../img-mwsm/belarus.png",2),new g("Germany","../../img-mwsm/germany.png",1.67),new g("Hungary","../../img-mwsm/hungary.png",1.5),new g("Kazakhstan","../../img-mwsm/kazakhstan.png",2),new g("Poland","../../img-mwsm/poland.png",1.6),new g("Russia","../../img-mwsm/russia.png",2),new g("Ukraine","../../img-mwsm/ukraine.png",2),new g("United Kingdom","../../img-mwsm/united-kingdom.png",2),new g("USA","../../img-mwsm/usa.png",1.9)];class p{constructor(){this.x=0,this.y=0,this.width=0,this.height=0}}class v{constructor(e,t){this._kind=Array.from(w).find(e=>"point"===e[0]),this._isAnimate=!1,this._wasAnimate=!1,this._serialNumber=0,this._isSelected=!1,this._x=e,this._y=t}get kind(){return this._kind}set kind(e){this._kind=e}get x(){return this._x}set x(e){this._x=e}get y(){return this._y}set y(e){this._y=e}get isAnimate(){return this._isAnimate}set isAnimate(e){this._isAnimate=e}get wasAnimate(){return this._wasAnimate}set wasAnimate(e){this._wasAnimate=e}get serialNumber(){return this._serialNumber}set serialNumber(e){this._serialNumber=e}get isSelected(){return this._isSelected}set isSelected(e){this._isSelected=e}toString(){return`${this.serialNumber}. ${this.kind[0]} ${Math.round(this.x)}x${Math.round(this.y)}.`}}class _ extends v{constructor(e,t,i){super(e,t),this._widthOriginal=i,this._width=this._widthOriginal,this.kind=Array.from(w).find(e=>"figure"===e[0])}get widthOriginal(){return this._widthOriginal}set widthOriginal(e){this._widthOriginal=e}get width(){return this._width}set width(e){this._width=e}toString(){return`${this.serialNumber}. ${this.kind[0]} ${Math.round(this.x)}x${Math.round(this.y)}/w${Math.round(this.width)}.`}restoreWidth(){this.width=this.widthOriginal}}class b{constructor(e=20,t=30,i=100,s=50){this._length=e,this._amplitude=t,this._period=i,this._shading=s}get length(){return this._length}set length(e){this._length=e}get amplitude(){return this._amplitude}set amplitude(e){this._amplitude=e}get period(){return this._period}set period(e){this._period=e}get shading(){return this._shading}set shading(e){this._shading=e}}class f extends _{constructor(e,t,i,s=0,a=2){super(e,t,i),this._waveParams=new b,this._heightOriginal=s,this._height=this._heightOriginal,this._borderWidth=a,this.kind=Array.from(w).find(e=>"rectangle"===e[0]),this.setAspectRatio()}get heightOriginal(){return this._heightOriginal}set heightOriginal(e){this._heightOriginal=e}get height(){return this._height}set height(e){this._height=e}get borderWidth(){return this._borderWidth}set borderWidth(e){this._borderWidth=e}get aspectRatio(){return this._aspectRatio}set aspectRatio(e){this._aspectRatio=e}get waveParams(){return this._waveParams}toString(){return`${this.serialNumber}. ${this.kind[0]} ${Math.round(this.x)}x${Math.round(this.y)} w${Math.round(this.width)}/h${Math.round(this.height)}.`}restoreHeight(){this.height=this.heightOriginal}setOriginal(){this.widthOriginal=this.width,this.heightOriginal=this.height}setAspectRatio(){0===this.height?this.aspectRatio=NaN:this.aspectRatio=this.width/this.height}}class P extends f{constructor(e,t,i,s){super(e,t,i),this._insideX=0,this._insideY=0,this._insideWidth=0,this._insideHeight=0,this.kind=Array.from(w).find(e=>"flag"===e[0]),this._country=s,this.borderWidth=3}get country(){return this._country}get insideX(){return this._insideX}set insideX(e){this._insideX=e}get insideY(){return this._insideY}set insideY(e){this._insideY=e}get insideWidth(){return this._insideWidth}set insideWidth(e){this._insideWidth=e}get insideHeight(){return this._insideHeight}set insideHeight(e){this._insideHeight=e}toString(){return`${this.serialNumber}. ${this.kind[0]} ${this.country[0]} ${Math.round(this.x)}x${Math.round(this.y)} w${Math.round(this.width)}/h${Math.round(this.height)}.`}}class C extends P{constructor(e,t,i,s,a,r=2){super(e,t,i,s),this._url="",this._isLoad=!1,this._img=new Image,this._url=a,this.aspectRatio=r,this.img.addEventListener("load",()=>{this._isLoad=!0},!1),this.img.src=this.url}get url(){return this._url}get isLoad(){return this._isLoad}get img(){return this._img}}let E=(()=>{class e{constructor(e,t,i,s,a,r,n,h,o,l,d,m,c,u,w,g,S,p,v,_,b,f,P,C,E,x,R,y,I,M){this._params=e,this._showParms=t,this._modalParms=i,this._modalParmsOK=s,this._modalParmsScaleAreaPanel=a,this._modalParmsFillTypePanel=r,this._modalParmsSelectedItemInfo=n,this._modalParmsShowSelectedItemWidthValue=h,this._modalParmsSelectedItemWidth=o,this._modalParmsSelectedItemWidthRange=l,this._modalParmsShowSelectedItemHeightValue=d,this._modalParmsSelectedItemHeight=m,this._modalParmsSelectedItemHeightRange=c,this._modalParmsShowSelectedItemLengthwaveValue=u,this._modalParmsSelectedItemLengthwave=w,this._modalParmsSelectedItemLengthwaveRange=g,this._modalParmsShowSelectedItemAmplitudewaveValue=S,this._modalParmsSelectedItemAmplitudewave=p,this._modalParmsSelectedItemAmplitudewaveRange=v,this._modalParmsShowSelectedItemPeriodwaveValue=_,this._modalParmsSelectedItemPeriodwave=b,this._modalParmsSelectedItemPeriodwaveRange=f,this._modalParmsShowSelectedItemShadingwaveValue=P,this._modalParmsSelectedItemShadingwave=C,this._modalParmsSelectedItemShadingwaveRange=E,this._modalParmsIsOffscreenCanvas=x,this._modalParmsIsTrackProportionsAreaMotion=R,this._modalParmsIsTranslucentModal=y,this._modalParmsSetDefault=I,this._menuSelect=M,this.CreateItemsOfFillTypePanel(this._modalParmsFillTypePanel),this.CreateItemsOfScaleAreaPanel(this._modalParmsScaleAreaPanel),this.InitSelectedItemInfo(),this.DefineEvents(),this.Show()}static get instance(){if(!e._instance)throw new Error("Instance of ViewParams was not created.");return e._instance}static Create(t,i,s,a,r,n,h,o,l,d,m,c,u,w,g,S,p,v,_,b,f,P,C,E,x,R,y,I,M,z){return e._instance||(e._instance=new e(t,i,s,a,r,n,h,o,l,d,m,c,u,w,g,S,p,v,_,b,f,P,C,E,x,R,y,I,M,z)),e._instance}Open(){for(let e of document.getElementsByName("scale"))this._params.scale[1]==Number(e.dataset.scale)&&(e.checked=!0);this._modalParmsIsTrackProportionsAreaMotion.checked=this._params.isTrackProportionsAreaMotion,this._modalParmsIsTranslucentModal.checked=this._params.isTranslucentModal,this.SetOpacityModal(this._params.isTranslucentModal),this._modalParmsOK.onclick=()=>{this._modalParms.style.display="none"},this._modalParms.style.display="block"}DefineEvents(){for(let e of document.getElementsByName("fill"))e.addEventListener("click",()=>{this._params.fill=Array.from(n.entries()).find(t=>t[1]===Number(e.dataset.fill))},!1);for(let e of document.getElementsByName("scale"))e.addEventListener("click",()=>{this._params.scale=Array.from(r.entries()).find(t=>t[1]===Number(e.dataset.scale))},!1);this._modalParmsIsOffscreenCanvas.addEventListener("click",()=>{this._params.isOffScreenCanvas=this._modalParmsIsOffscreenCanvas.checked},!1),this._modalParmsIsTranslucentModal.addEventListener("click",()=>{this._params.isTranslucentModal=this._modalParmsIsTranslucentModal.checked},!1),this._modalParmsIsTrackProportionsAreaMotion.addEventListener("click",()=>{this._params.isTrackProportionsAreaMotion=this._modalParmsIsTrackProportionsAreaMotion.checked},!1),document.addEventListener(this._params.nameEventIsTranslucent,e=>{this.OnIsTranslucentModal(e)},!1),document.addEventListener(c.instance.nameEventCanvasCoordinates,e=>{this.OnChangeCanvasCoordinates(e)},!1),document.addEventListener(c.instance.nameEventSerialNumberTracking,e=>{this.OnSerialNumberTracking(e)},!1),document.addEventListener(c.instance.nameEventWPropStored,e=>{this.OnChangeWPropStored(e)},!1),document.addEventListener("CustomEventPermissionsIsSelected",e=>{this.PermissionsIsSelected(e)},!1),window.addEventListener("resize",()=>{this.OnWindowChange()},!1),window.addEventListener("scroll",()=>{this.OnWindowChange()},!1)}Show(){let e=!1,t=!1;this._params.wPropStored.serialNumber>0&&(e=!0,t="flag"==this._params.wPropStored.kind[0]),this._showParms.innerHTML="";let i=document.createElement("p");i.innerHTML="Тип&nbspзаливки:&nbsp<span "+(t?"":'data-menu="fill"')+`>${this._params.wPropStored.fillType[0]}</span>`+`&nbsp; Масштабность:&nbsp;<span data-menu="scale">${this._params.scale[0]}</span>&nbsp; SN-tracking:&nbsp`+this._params.serialNumberTracking+`&nbsp; <b>${this._params.wPropStored.kind[0].charAt(0).toUpperCase()}${this._params.wPropStored.kind[0].slice(1)}-${this._params.wPropStored.serialNumber}</b>&nbsp; X:&nbsp`+this._params.wPropStored.x+"&nbsp; Y:&nbsp"+this._params.wPropStored.y+`&nbsp; <span data-range="width">Width:</span>&nbsp<span contenteditable="${e}" data-name="width" data-validate="true">${this._params.wPropStored.width}</span>&nbsp; <span `+(t?"":'data-range="height"')+`>Height:</span>&nbsp<span contenteditable="${e&&!t}" data-name="height" data-validate="true">${this._params.wPropStored.height}</span>&nbsp; <b>Колебания</b>`+`&nbsp; <span data-range="lengthwave">Длина:</span>&nbsp<span contenteditable="${e}" data-name="lengthwave" data-validate="true">${this._params.wPropStored.waveLength}</span>`+`&nbsp; <span data-range="amplitudewave">Амплитуда:</span>&nbsp<span contenteditable="${e}" data-name="amplitudewave" data-validate="true">${this._params.wPropStored.waveAmplitude}</span>`+`&nbsp; <span data-range="periodwave">Период:</span>&nbsp<span contenteditable="${e}" data-name="periodwave" data-validate="true">${this._params.wPropStored.wavePeriod}</span>`+`&nbsp; <span data-range="shading">Затенение:</span>&nbsp<span contenteditable="${e}" data-name="shading" data-validate="true">${this._params.wPropStored.waveShading}</span>&nbsp; Координаты:&nbsp`+this._params.canvasCoordinates,this._modalParmsShowSelectedItemWidthValue.contentEditable=""+e,this._modalParmsShowSelectedItemHeightValue.contentEditable=""+(e&&!t),this._modalParmsShowSelectedItemLengthwaveValue.contentEditable=""+e,this._modalParmsShowSelectedItemAmplitudewaveValue.contentEditable=""+e,this._modalParmsShowSelectedItemPeriodwaveValue.contentEditable=""+e,this._modalParmsShowSelectedItemShadingwaveValue.contentEditable=""+e,this._showParms.appendChild(i),this.DefineEventsContenteditable(),this.DefineEventsParamSelect(),this.DefineEventsRange(),this.InitRangesTitle()}DefineEventsContenteditable(){for(let e of document.querySelectorAll("[contenteditable=true]"))e.oninput=e=>{this.RangeContenteditableValidate(e)},e.onblur=e=>{this.SetRangeContenteditable(e)},e.onkeydown=e=>{this.RangeEnter(e)}}DefineEventsParamSelect(){for(let e of document.querySelectorAll("[data-menu]"))e.onclick=e=>{this.OnParamMenuClick(e)}}DefineEventsRange(){for(let e of document.querySelectorAll("[data-range]"))e.onclick=e=>{this.OnParamRangeClick(e)}}InitRangesTitle(){for(let e of document.querySelectorAll("[contenteditable]")){switch(e.dataset.name){case"width":e.title=`${this._modalParmsSelectedItemWidth.min}/${this._modalParmsSelectedItemWidth.max}`;break;case"height":e.title=`${this._modalParmsSelectedItemHeight.min}/${this._modalParmsSelectedItemHeight.max}`;break;case"lengthwave":e.title=`${this._modalParmsSelectedItemLengthwave.min}/${this._modalParmsSelectedItemLengthwave.max}`;break;case"amplitudewave":e.title=`${this._modalParmsSelectedItemAmplitudewave.min}/${this._modalParmsSelectedItemAmplitudewave.max}`;break;case"periodwave":e.title=`${this._modalParmsSelectedItemPeriodwave.min}/${this._modalParmsSelectedItemPeriodwave.max}`;break;case"shading":e.title=`${this._modalParmsSelectedItemShadingwave.min}/${this._modalParmsSelectedItemShadingwave.max}`}}}RangeContenteditableValidate(e){let t=e.target;/^0+/.test(t.innerText)&&t.innerText.length>1&&(t.innerText=t.innerText.replace(/^0+/,"")),/\n/g.test(t.innerText)&&(t.innerText=t.innerText.replace(/\n/g,"")),t.dataset.validate=this.IsRangeContenteditableValidate(t.innerText,t.dataset.name).toString()}SetRangeContenteditable(e){let t=e.target;if(this.IsRangeContenteditableValidate(t.innerText,t.dataset.name)&&!this.IsEqualNewOld(Number(t.innerText),t.dataset.name))switch(t.dataset.name){case"width":this.SetItemWidth(t.innerText);break;case"height":this.SetItemHeight(t.innerText);break;case"lengthwave":this.SetLengthWave(t.innerText);break;case"amplitudewave":this.SetAmplitudeWave(t.innerText);break;case"periodwave":this.SetPeriodWave(t.innerText);break;case"shading":this.SetShadingWave(t.innerText)}else this._modalParmsSelectedItemWidth.dispatchEvent(new Event("input")),this._modalParmsSelectedItemHeight.dispatchEvent(new Event("input")),this._modalParmsSelectedItemLengthwave.dispatchEvent(new Event("input")),this._modalParmsSelectedItemAmplitudewave.dispatchEvent(new Event("input")),this._modalParmsSelectedItemPeriodwave.dispatchEvent(new Event("input")),this._modalParmsSelectedItemShadingwave.dispatchEvent(new Event("input"))}RangeEnter(e){if(13==e.keyCode){let t=e.target;this.IsRangeContenteditableValidate(t.innerText,t.dataset.name)&&!this.IsEqualNewOld(Number(t.innerText),t.dataset.name)&&t.blur()}}IsRangeContenteditableValidate(e,t){let i=!1;if(/^[0-9]+$/.test(e)){i=!0;let s=Number(e);switch(t){case"width":(s<Number(this._modalParmsSelectedItemWidth.min)||s>Number(this._modalParmsSelectedItemWidth.max))&&(i=!1);break;case"height":(s<Number(this._modalParmsSelectedItemHeight.min)||s>Number(this._modalParmsSelectedItemHeight.max))&&(i=!1);break;case"lengthwave":(s<Number(this._modalParmsSelectedItemLengthwave.min)||s>Number(this._modalParmsSelectedItemLengthwave.max))&&(i=!1);break;case"amplitudewave":(s<Number(this._modalParmsSelectedItemAmplitudewave.min)||s>Number(this._modalParmsSelectedItemAmplitudewave.max))&&(i=!1);break;case"periodwave":(s<Number(this._modalParmsSelectedItemPeriodwave.min)||s>Number(this._modalParmsSelectedItemPeriodwave.max))&&(i=!1);break;case"shading":(s<Number(this._modalParmsSelectedItemShadingwave.min)||s>Number(this._modalParmsSelectedItemShadingwave.max))&&(i=!1)}}return i}IsEqualNewOld(e,t){let i=!1;switch(t){case"width":e==this._params.wPropStored.width&&(i=!0);break;case"height":e==this._params.wPropStored.height&&(i=!0);break;case"lengthwave":e==this._params.wPropStored.waveLength&&(i=!0);break;case"amplitudewave":e==this._params.wPropStored.waveAmplitude&&(i=!0);break;case"periodwave":e==this._params.wPropStored.wavePeriod&&(i=!0);break;case"shading":e==this._params.wPropStored.waveShading&&(i=!0)}return i}CreateItemsOfFillTypePanel(e,t=!1){let i,s;for(let a of n.entries())i=document.createElement("input"),i.type="radio",i.name=t?"menu-fill":"fill",i.id=t?"menu-fill-"+a[1]:"fill-"+a[1],i.dataset.fill=""+a[1],s=document.createElement("label"),s.htmlFor=i.id,s.innerText=a[0],a[1]==this._params.wPropStored.fillType[1]&&(i.checked=!0),t&&(i.onclick=e=>{let t=e.target;this._params.fill=Array.from(n.entries()).find(e=>e[1]===Number(t.dataset.fill)),this.Show(),this.DisableMenuSelect()}),e.appendChild(i),e.appendChild(s)}CreateItemsOfScaleAreaPanel(e,t=!1){let i,s;for(let a of r.entries())i=document.createElement("input"),i.type="radio",i.name=t?"menu-scale":"scale",i.id=t?"menu-scale-"+a[1]:"scale-"+a[1],i.dataset.scale=""+a[1],s=document.createElement("label"),s.htmlFor=i.id,s.innerText=a[0],a[1]==this._params.scale[1]&&(i.checked=!0),t&&(i.onclick=e=>{let t=e.target;this._params.scale=Array.from(r.entries()).find(e=>e[1]===Number(t.dataset.scale)),this.Show(),this.DisableMenuSelect()}),e.appendChild(i),e.appendChild(s)}InitSelectedItemInfo(){this.SetSelectedItemInfo(),this.SetSizeConstraintsForSelectedItem(),this._modalParmsSelectedItemWidth.addEventListener("change",()=>{this._params.wPropStored.width=Number(this._modalParmsSelectedItemWidth.value),this.Show(),document.dispatchEvent(new CustomEvent(this._params.nameEventWPropStoredWidthChanged,{bubbles:!0,detail:{value:Number(this._modalParmsSelectedItemWidth.value)}}))},!1),this._modalParmsSelectedItemWidth.addEventListener("input",()=>{this._modalParmsShowSelectedItemWidthValue.innerText=this._modalParmsSelectedItemWidth.value,document.dispatchEvent(new CustomEvent(this._params.nameEventWPropStoredWidthChanged,{bubbles:!0,detail:{value:Number(this._modalParmsSelectedItemWidth.value)}}))},!1),this._modalParmsSelectedItemHeight.addEventListener("change",()=>{this._params.wPropStored.height=Number(this._modalParmsSelectedItemHeight.value),this.Show(),document.dispatchEvent(new CustomEvent(this._params.nameEventWPropStoredHeightChanged,{bubbles:!0,detail:{value:Number(this._modalParmsSelectedItemHeight.value)}}))},!1),this._modalParmsSelectedItemHeight.addEventListener("input",()=>{this._modalParmsShowSelectedItemHeightValue.innerText=this._modalParmsSelectedItemHeight.value,document.dispatchEvent(new CustomEvent(this._params.nameEventWPropStoredHeightChanged,{bubbles:!0,detail:{value:Number(this._modalParmsSelectedItemHeight.value)}}))},!1),this.SetSelectedItemSize(),this._modalParmsSelectedItemLengthwave.addEventListener("change",()=>{this._params.wPropStored.waveLength=Number(this._modalParmsSelectedItemLengthwave.value),this.Show(),document.dispatchEvent(new CustomEvent(this._params.nameEventWPropStoredLengthWaveChanged,{bubbles:!0,detail:{value:Number(this._modalParmsSelectedItemLengthwave.value)}}))},!1),this._modalParmsSelectedItemLengthwave.addEventListener("input",()=>{this._modalParmsShowSelectedItemLengthwaveValue.innerText=this._modalParmsSelectedItemLengthwave.value,document.dispatchEvent(new CustomEvent(this._params.nameEventWPropStoredLengthWaveChanged,{bubbles:!0,detail:{value:Number(this._modalParmsSelectedItemLengthwave.value)}}))},!1),this.SetSelectedItemLengthWave(),this._modalParmsSelectedItemAmplitudewave.addEventListener("change",()=>{this._params.wPropStored.waveAmplitude=Number(this._modalParmsSelectedItemAmplitudewave.value),this.Show(),document.dispatchEvent(new CustomEvent(this._params.nameEventWPropStoredAmplitudeWaveChanged,{bubbles:!0,detail:{value:Number(this._modalParmsSelectedItemAmplitudewave.value)}}))},!1),this._modalParmsSelectedItemAmplitudewave.addEventListener("input",()=>{this._modalParmsShowSelectedItemAmplitudewaveValue.innerText=this._modalParmsSelectedItemAmplitudewave.value,document.dispatchEvent(new CustomEvent(this._params.nameEventWPropStoredAmplitudeWaveChanged,{bubbles:!0,detail:{value:Number(this._modalParmsSelectedItemAmplitudewave.value)}}))},!1),this.SetSelectedItemAmplitudeWave(),this._modalParmsSelectedItemPeriodwave.addEventListener("change",()=>{this._params.wPropStored.wavePeriod=Number(this._modalParmsSelectedItemPeriodwave.value),this.Show(),document.dispatchEvent(new CustomEvent(this._params.nameEventWPropStoredPeriodWaveChanged,{bubbles:!0,detail:{value:Number(this._modalParmsSelectedItemPeriodwave.value)}}))},!1),this._modalParmsSelectedItemPeriodwave.addEventListener("input",()=>{this._modalParmsShowSelectedItemPeriodwaveValue.innerText=this._modalParmsSelectedItemPeriodwave.value,document.dispatchEvent(new CustomEvent(this._params.nameEventWPropStoredPeriodWaveChanged,{bubbles:!0,detail:{value:Number(this._modalParmsSelectedItemPeriodwave.value)}}))},!1),this.SetSelectedItemPeriodWave(),this._modalParmsSelectedItemShadingwave.addEventListener("change",()=>{this._params.wPropStored.waveShading=Number(this._modalParmsSelectedItemShadingwave.value),this.Show(),document.dispatchEvent(new CustomEvent(this._params.nameEventWPropStoredShadingWaveChanged,{bubbles:!0,detail:{value:Number(this._modalParmsSelectedItemShadingwave.value)}}))},!1),this._modalParmsSelectedItemShadingwave.addEventListener("input",()=>{this._modalParmsShowSelectedItemShadingwaveValue.innerText=this._modalParmsSelectedItemShadingwave.value,document.dispatchEvent(new CustomEvent(this._params.nameEventWPropStoredShadingWaveChanged,{bubbles:!0,detail:{value:Number(this._modalParmsSelectedItemShadingwave.value)}}))},!1),this.SetSelectedItemShadingWave(),this.SetSelectedItemShadingWave()}SetSizeConstraintsForSelectedItem(){if(this._params.wPropStored.serialNumber>0){let e=this._params.scale[1],t=Math.round(e/2);this._modalParmsSelectedItemWidth.min=Math.max(u.figureWidthMin,Math.floor(this._params.wPropStored.measureCaptionHead.width+2*c.instance.sizeResizingZone+this._params.wPropStored.measureCaptionMinimize.width+2*c.instance.sizeResizingZone+this._params.wPropStored.measureCaptionMaximize.width+2*c.instance.sizeResizingZone+this._params.wPropStored.measureCaptionClose.width+c.instance.sizeResizingZone)).toString(),this._modalParmsSelectedItemWidth.max=(e-this._params.wPropStored.x-1).toString(),this._modalParmsSelectedItemHeight.min=(this._params.wPropStored.headerHeight+2*this._params.wPropStored.borderWidth+5).toString(),this._modalParmsSelectedItemHeight.max=(t-this._params.wPropStored.y-1).toString()}else this._modalParmsSelectedItemWidth.min="0",this._modalParmsSelectedItemWidth.max="0",this._modalParmsSelectedItemHeight.min="0",this._modalParmsSelectedItemHeight.max="0";this._modalParmsSelectedItemWidthRange.innerHTML=`${this._modalParmsSelectedItemWidth.min}/${this._modalParmsSelectedItemWidth.max}`,this._modalParmsSelectedItemHeightRange.innerHTML=`${this._modalParmsSelectedItemHeight.min}/${this._modalParmsSelectedItemHeight.max}`}SetSelectedItemInfo(){this._params.wPropStored.serialNumber>0?this._modalParmsSelectedItemInfo.innerHTML=`${this._params.wPropStored.kind[0].charAt(0).toUpperCase()}${this._params.wPropStored.kind[0].slice(1)}-${this._params.wPropStored.serialNumber}, X:&nbsp${this._params.wPropStored.x}, Y:&nbsp${this._params.wPropStored.y}`:this._modalParmsSelectedItemInfo.innerHTML=""}SetSelectedItemSize(){this._modalParmsSelectedItemWidth.value=this._params.wPropStored.width.toString(),this._modalParmsSelectedItemHeight.value=this._params.wPropStored.height.toString(),this._modalParmsShowSelectedItemWidthValue.innerText=this._modalParmsSelectedItemWidth.value,this._modalParmsShowSelectedItemHeightValue.innerText=this._modalParmsSelectedItemHeight.value}SetSelectedItemLengthWave(){this._params.wPropStored.serialNumber>0?(this._modalParmsSelectedItemLengthwave.min=u.waveLenghthMin.toString(),this._modalParmsSelectedItemLengthwave.max=u.waveLenghthMax.toString()):(this._modalParmsSelectedItemLengthwave.min="0",this._modalParmsSelectedItemLengthwave.max="0"),this._modalParmsSelectedItemLengthwave.value=this._params.wPropStored.waveLength.toString(),this._modalParmsShowSelectedItemLengthwaveValue.innerText=this._modalParmsSelectedItemLengthwave.value,this._modalParmsSelectedItemLengthwaveRange.innerHTML=`${this._modalParmsSelectedItemLengthwave.min}/${this._modalParmsSelectedItemLengthwave.max}`}SetSelectedItemAmplitudeWave(){this._params.wPropStored.serialNumber>0?(this._modalParmsSelectedItemAmplitudewave.min=u.waveAmplitudeMin.toString(),this._modalParmsSelectedItemAmplitudewave.max=u.waveAmplitudeMax.toString()):(this._modalParmsSelectedItemAmplitudewave.min="0",this._modalParmsSelectedItemAmplitudewave.max="0"),this._modalParmsSelectedItemAmplitudewave.value=this._params.wPropStored.waveAmplitude.toString(),this._modalParmsShowSelectedItemAmplitudewaveValue.innerText=this._modalParmsSelectedItemAmplitudewave.value,this._modalParmsSelectedItemAmplitudewaveRange.innerHTML=`${this._modalParmsSelectedItemAmplitudewave.min}/${this._modalParmsSelectedItemAmplitudewave.max}`}SetSelectedItemPeriodWave(){this._params.wPropStored.serialNumber>0?(this._modalParmsSelectedItemPeriodwave.min=u.wavePeriodMin.toString(),this._modalParmsSelectedItemPeriodwave.max=u.wavePeriodMax.toString()):(this._modalParmsSelectedItemPeriodwave.min="0",this._modalParmsSelectedItemPeriodwave.max="0"),this._modalParmsSelectedItemPeriodwave.value=this._params.wPropStored.wavePeriod.toString(),this._modalParmsShowSelectedItemPeriodwaveValue.innerText=this._modalParmsSelectedItemPeriodwave.value,this._modalParmsSelectedItemPeriodwaveRange.innerHTML=`${this._modalParmsSelectedItemPeriodwave.min}/${this._modalParmsSelectedItemPeriodwave.max}`}SetSelectedItemShadingWave(){this._params.wPropStored.serialNumber>0?(this._modalParmsSelectedItemShadingwave.min=u.waveShadingMin.toString(),this._modalParmsSelectedItemShadingwave.max=u.waveShadingMax.toString()):(this._modalParmsSelectedItemShadingwave.min="0",this._modalParmsSelectedItemShadingwave.max="0"),this._modalParmsSelectedItemShadingwave.value=this._params.wPropStored.waveShading.toString(),this._modalParmsShowSelectedItemShadingwaveValue.innerText=this._modalParmsSelectedItemShadingwave.value,this._modalParmsSelectedItemShadingwaveRange.innerHTML=`${this._modalParmsSelectedItemShadingwave.min}/${this._modalParmsSelectedItemShadingwave.max}`}OnParamMenuClick(e){let t=e.target;if(Object(s.a)(this._menuSelect)&&this._menuSelect.dataset.type===t.dataset.menu)return void this.DisableMenuSelect();this._menuSelect.dataset.type=t.dataset.menu,this._menuSelect.innerHTML="";let i=t.getBoundingClientRect();switch(this._menuSelect.style.left=i.left+5+"px",this._menuSelect.style.top=i.bottom+"px",t.dataset.menu){case"fill":this.CreateItemsOfFillTypePanel(this._menuSelect,!0);break;case"scale":this.CreateItemsOfScaleAreaPanel(this._menuSelect,!0);break;default:this._menuSelect.innerHTML=`<p>${t.dataset.menu}</p>`}this._menuSelect.className="overflow-auto add-conditions",this._menuSelect.style.display="flex"}OnParamRangeClick(e){let t=e.target;if(Object(s.a)(this._menuSelect)&&this._menuSelect.dataset.type===t.dataset.range)return void this.DisableMenuSelect();this._menuSelect.dataset.type=t.dataset.range,this._menuSelect.innerHTML="";let i=t.getBoundingClientRect();switch(this._menuSelect.style.left=i.left+5+"px",this._menuSelect.style.top=i.bottom+"px",this._menuSelect.className="pop-up-range",t.dataset.range){case"width":this.CreatePopUpRange(t.dataset.range,this._params.wPropStored.width,[Number(this._modalParmsSelectedItemWidth.min),Number(this._modalParmsSelectedItemWidth.max)]);break;case"height":this.CreatePopUpRange(t.dataset.range,this._params.wPropStored.height,[Number(this._modalParmsSelectedItemHeight.min),Number(this._modalParmsSelectedItemHeight.max)]);break;case"lengthwave":this.CreatePopUpRange(t.dataset.range,this._params.wPropStored.waveLength,[Number(this._modalParmsSelectedItemLengthwave.min),Number(this._modalParmsSelectedItemLengthwave.max)]);break;case"amplitudewave":this.CreatePopUpRange(t.dataset.range,this._params.wPropStored.waveAmplitude,[Number(this._modalParmsSelectedItemAmplitudewave.min),Number(this._modalParmsSelectedItemAmplitudewave.max)]);break;case"periodwave":this.CreatePopUpRange(t.dataset.range,this._params.wPropStored.wavePeriod,[Number(this._modalParmsSelectedItemPeriodwave.min),Number(this._modalParmsSelectedItemPeriodwave.max)]);break;case"shading":this.CreatePopUpRange(t.dataset.range,this._params.wPropStored.waveShading,[Number(this._modalParmsSelectedItemShadingwave.min),Number(this._modalParmsSelectedItemShadingwave.max)]);break;default:this._menuSelect.innerHTML=`<p>${t.dataset.range}</p>`}this._menuSelect.style.display="flex"}CreatePopUpRange(e,t,i){let s=document.createElement("div");s.innerHTML=`${i[0]}/${i[1]}`;let a=document.createElement("div");a.className="range-wrapper";let r=document.createElement("input");r.type="range",r.dataset.popUpRange=e,r.addEventListener("change",e=>{this.OnPopUpRangeChange(e)},!1),r.addEventListener("input",e=>{this.OnPopUpRangeChange(e)},!1),r.min=i[0].toString(),r.max=i[1].toString(),r.value=t.toString(),a.appendChild(r),this._menuSelect.appendChild(s),this._menuSelect.appendChild(a)}OnPopUpRangeChange(e){let t=e.target;switch(t.dataset.popUpRange){case"width":this.SetItemWidth(t.value);break;case"height":this.SetItemHeight(t.value);break;case"lengthwave":this.SetLengthWave(t.value);break;case"amplitudewave":this.SetAmplitudeWave(t.value);break;case"periodwave":this.SetPeriodWave(t.value);break;case"shading":this.SetShadingWave(t.value)}this.Show()}SetItemWidth(e){this._modalParmsSelectedItemWidth.value=e,this._modalParmsSelectedItemWidth.dispatchEvent(new Event("input")),this._modalParmsSelectedItemWidth.dispatchEvent(new Event("change"))}SetItemHeight(e){this._modalParmsSelectedItemHeight.value=e,this._modalParmsSelectedItemHeight.dispatchEvent(new Event("input")),this._modalParmsSelectedItemHeight.dispatchEvent(new Event("change"))}SetLengthWave(e){this._modalParmsSelectedItemLengthwave.value=e,this._modalParmsSelectedItemLengthwave.dispatchEvent(new Event("input")),this._modalParmsSelectedItemLengthwave.dispatchEvent(new Event("change"))}SetAmplitudeWave(e){this._modalParmsSelectedItemAmplitudewave.value=e,this._modalParmsSelectedItemAmplitudewave.dispatchEvent(new Event("input")),this._modalParmsSelectedItemAmplitudewave.dispatchEvent(new Event("change"))}SetPeriodWave(e){this._modalParmsSelectedItemPeriodwave.value=e,this._modalParmsSelectedItemPeriodwave.dispatchEvent(new Event("input")),this._modalParmsSelectedItemPeriodwave.dispatchEvent(new Event("change"))}SetShadingWave(e){this._modalParmsSelectedItemShadingwave.value=e,this._modalParmsSelectedItemShadingwave.dispatchEvent(new Event("input")),this._modalParmsSelectedItemShadingwave.dispatchEvent(new Event("change"))}OnIsTranslucentModal(e){this.SetOpacityModal(e.detail.value)}SetOpacityModal(e){this._modalParms.style.opacity=e?"0.7":"1"}OnWindowChange(){this.DisableMenuSelect()}DisableMenuSelect(){this._menuSelect.dataset.type="empty",this._menuSelect.style.display="none"}OnChangeCanvasCoordinates(e){this.Show()}OnSerialNumberTracking(e){this.Show()}OnChangeWPropStored(e){this.Show();for(let e of document.getElementsByName("fill"))this._params.wPropStored.fillType[1]==Number(e.dataset.fill)&&(e.checked=!0);this.SetSelectedItemInfo(),this.SetSizeConstraintsForSelectedItem(),this.SetSelectedItemSize(),this.SetSelectedItemLengthWave(),this.SetSelectedItemAmplitudeWave(),this.SetSelectedItemPeriodWave(),this.SetSelectedItemShadingWave()}PermissionsIsSelected(e){"rectangle"==e.detail.kind[0]?this.SetPermissionIsSelected(!1):"flag"==e.detail.kind[0]&&this.SetPermissionIsSelected(!0)}SetPermissionIsSelected(e){this.Show(),this._modalParmsSelectedItemHeight.disabled=e;for(let t of document.getElementsByName("fill"))t.disabled=e}}return e._instance=void 0,e})();class x{constructor(){this.app="MultiSystemWindowModeling-List"}}class R{constructor(){this.list=[]}}var y;!function(e){e[e.NoDirection=0]="NoDirection",e[e.EastWestLeft=1]="EastWestLeft",e[e.EastWestRight=2]="EastWestRight",e[e.NorthSouthTop=3]="NorthSouthTop",e[e.NorthSouthDown=4]="NorthSouthDown",e[e.NESWTopRight=5]="NESWTopRight",e[e.NESWBootomLeft=6]="NESWBootomLeft",e[e.NWSELeftTop=7]="NWSELeftTop",e[e.NWSERightBottom=8]="NWSERightBottom"}(y||(y={}));class I{constructor(){this._mouseMove=new Map,this._mouseDown=new Map,this._mouseUp=new Map,this._mouseClick=new Map}get mouseMove(){return this._mouseMove}get mouseDown(){return this._mouseDown}get mouseUp(){return this._mouseUp}get mouseClick(){return this._mouseClick}}let M=(()=>{class e{constructor(){this._serialNumberResizeEW=0,this._serialNumberResizeNS=0,this._serialNumberResizeNESW=0,this._serialNumberResizeNWSE=0,this._directResizing=y.NoDirection,this._sizeResizingZone=0,this._serialNumberHoverClose=0,this._serialNumberHoverMinimize=0,this._serialNumberHoverMaximize=0,this._serialNumberHoverRestoreDown=0}static get instance(){return e._instance||(e._instance=new e),e._instance}get serialNumberResizeEW(){return this._serialNumberResizeEW}set serialNumberResizeEW(e){this._serialNumberResizeEW=e}get serialNumberResizeNS(){return this._serialNumberResizeNS}set serialNumberResizeNS(e){this._serialNumberResizeNS=e}get serialNumberResizeNESW(){return this._serialNumberResizeNESW}set serialNumberResizeNESW(e){this._serialNumberResizeNESW=e}get serialNumberResizeNWSE(){return this._serialNumberResizeNWSE}set serialNumberResizeNWSE(e){this._serialNumberResizeNWSE=e}get directResizing(){return this._directResizing}set directResizing(e){this._directResizing=e}get sizeResizingZone(){return this._sizeResizingZone}set sizeResizingZone(e){this._sizeResizingZone=e}get serialNumberHoverClose(){return this._serialNumberHoverClose}set serialNumberHoverClose(e){this._serialNumberHoverClose=e}get serialNumberHoverMinimize(){return this._serialNumberHoverMinimize}set serialNumberHoverMinimize(e){this._serialNumberHoverMinimize=e}get serialNumberHoverMaximize(){return this._serialNumberHoverMaximize}set serialNumberHoverMaximize(e){this._serialNumberHoverMaximize=e}get serialNumberHoverRestoreDown(){return this._serialNumberHoverRestoreDown}set serialNumberHoverRestoreDown(e){this._serialNumberHoverRestoreDown=e}Clear(){this.serialNumberResizeEW=0,this.serialNumberResizeNS=0,this.serialNumberResizeNESW=0,this.serialNumberResizeNWSE=0,this.directResizing=y.NoDirection}}return e._instance=void 0,e})();class z{constructor(e,t="yellow",i="Lightgray"){this._statesKeeper=M.instance,this._recoveryParameters=new l,this._headerHeight=0,this._fillType=n.entries().next().value,this._propertiesGradientInside=new a.d,this._propertiesGradientBorder=new a.d,this._fontSize=10,this._isMouseDown=!1,this._isResize=!1,this._isResizeEW=!1,this._isResizeNS=!1,this._isResizeNESW=!1,this._isResizeNWSE=!1,this._startMove=new v(0,0),this._newMove=new v(0,0),this._isMaximize=!1,this._isMinimize=!1,this._rectWave=new p,this._rect=e,this._colorFill=t,this._colorStroke=i,this.DefineEvents()}get statesKeeper(){return this._statesKeeper}get rect(){return this._rect}get headerHeight(){return this._headerHeight}set headerHeight(e){this._headerHeight=e}get fillType(){return this._fillType}set fillType(e){this._fillType=e}get colorFill(){return this._colorFill}set colorFill(e){this._colorFill=e}get colorStroke(){return this._colorStroke}set colorStroke(e){this._colorStroke=e}get gradientInside(){return this._gradientInside}set gradientInside(e){this._gradientInside=e}get gradientBorder(){return this._gradientBorder}set gradientBorder(e){this._gradientBorder=e}get propertiesGradientInside(){return this._propertiesGradientInside}set propertiesGradientInside(e){this._propertiesGradientInside=e}get propertiesGradientBorder(){return this._propertiesGradientBorder}set propertiesGradientBorder(e){this._propertiesGradientBorder=e}get measureCaptionHead(){return this._measureCaptionHead}set measureCaptionHead(e){this._measureCaptionHead=e}get measureCaptionMinimize(){return this._measureCaptionMinimize}set measureCaptionMinimize(e){this._measureCaptionMinimize=e}get measureCaptionRestoreDown(){return this._measureCaptionRestoreDown}set measureCaptionRestoreDown(e){this._measureCaptionRestoreDown=e}get measureCaptionMaximize(){return this._measureCaptionMaximize}set measureCaptionMaximize(e){this._measureCaptionMaximize=e}get measureCaptionClose(){return this._measureCaptionClose}set measureCaptionClose(e){this._measureCaptionClose=e}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize=e}get isMouseDown(){return this._isMouseDown}get isResize(){return this._isResize}set isResize(e){this._isResize=e}get isResizeEW(){return this._isResizeEW}set isResizeEW(e){this._isResizeEW=e}get isResizeNS(){return this._isResizeNS}set isResizeNS(e){this._isResizeNS=e}get isResizeNESW(){return this._isResizeNESW}set isResizeNESW(e){this._isResizeNESW=e}get isResizeNWSE(){return this._isResizeNWSE}set isResizeNWSE(e){this._isResizeNWSE=e}get startMove(){return this._startMove}get newMove(){return this._newMove}get isMaximize(){return this._isMaximize}set isMaximize(e){this._isMaximize=e}get isMinimize(){return this._isMinimize}set isMinimize(e){this._isMinimize=e}get recoveryParameters(){return this._recoveryParameters}draw(e){this.drawHeader(e,this.rect.kind[0]),e.globalAlpha=1,e.beginPath(),e.rect(this.rect.x,this.rect.y+this.headerHeight,this.rect.width,this.rect.height-this.headerHeight),"Цветная"===this.fillType[0]?e.fillStyle=this.colorStroke:"Линейный градиент"===this.fillType[0]?(this.gradientBorder=a.a.instance.RestoreFillRectLineGradient(e,this.rect.x,this.rect.y+this.headerHeight,this.rect.width,this.rect.height-this.headerHeight,this.propertiesGradientBorder),e.fillStyle=this.gradientBorder):"Радиальный градиент"===this.fillType[0]&&(this.gradientBorder=a.a.instance.GetFillRectRadialGradient(e,a.a.instance.GetRadialParams(this.rect.x,this.rect.y+this.headerHeight,this.rect.width,this.rect.height-this.headerHeight,this.propertiesGradientBorder.radialDirection),this.propertiesGradientBorder.colorScheme),e.fillStyle=this.gradientBorder),e.fill(),e.beginPath(),e.rect(this.rect.x+this.rect.borderWidth,this.rect.y+this.headerHeight+this.rect.borderWidth,this.rect.width-2*this.rect.borderWidth,this.rect.height-this.headerHeight-2*this.rect.borderWidth),"Цветная"===this.fillType[0]?e.fillStyle=this.colorFill:"Линейный градиент"===this.fillType[0]?(this.gradientInside=a.a.instance.RestoreFillRectLineGradient(e,this.rect.x+this.rect.borderWidth,this.rect.y+this.headerHeight+this.rect.borderWidth,this.rect.width-2*this.rect.borderWidth,this.rect.height-this.headerHeight-2*this.rect.borderWidth,this.propertiesGradientInside),e.fillStyle=this.gradientInside):"Радиальный градиент"===this.fillType[0]&&(this.gradientInside=a.a.instance.GetFillRectRadialGradient(e,a.a.instance.GetRadialParams(this.rect.x+this.rect.borderWidth,this.rect.y+this.headerHeight+this.rect.borderWidth,this.rect.width-2*this.rect.borderWidth,this.rect.height-this.headerHeight-2*this.rect.borderWidth,this.propertiesGradientInside.radialDirection),this.propertiesGradientInside.colorScheme),e.fillStyle=this.gradientInside),e.fill(),this.SetRectWave(),this._contextData=e.getImageData(this._rectWave.x,this._rectWave.y,this._rectWave.width,this._rectWave.height).data}wave(e){if(this.rect.isAnimate){let t=e.getImageData(this._rectWave.x,this._rectWave.y,this._rectWave.width,this._rectWave.height),i=t.data,a=Date.now()/this.rect.waveParams.period;for(let e=0;e<this._rectWave.height;++e){let t=0,s=0;for(let r=0;r<this._rectWave.width;++r){let n=4*(e*this._rectWave.width+r),h=Math.sin(r/this.rect.waveParams.length-a)*this.rect.waveParams.amplitude*r/this._rectWave.width,o=4*((e+h<<0)*this._rectWave.width+r);s=(h-t)*this.rect.waveParams.shading,i[n]=this._contextData[o]+s,i[n+1]=this._contextData[o+1]+s,i[n+2]=this._contextData[o+2]+s,i[n+3]=this._contextData[o+3],t=h}}e.putImageData(t,this._rectWave.x,this._rectWave.y),Object(s.b)(()=>this.wave(e))}}mouseDownHandler(e,t,i,s,a){if(this.isMinimize)return 0;let r=this.GetMaxLayer(e,t,s,a);return this.isInside(e,t,r,s)?(c.instance.serialNumberTracking=this.rect.serialNumber,this._isMouseDown=!0,this.rect.setOriginal(),this.startMove.x=e,this.startMove.y=t,this.rect.isSelected||document.dispatchEvent(new CustomEvent("CustomEventIsSelected",{bubbles:!0,detail:{serialNumber:this.rect.serialNumber,x:e,y:t}})),this.rect.serialNumber):0}mouseMoveHandler(e,t,i,s,a){if(this.isMinimize)return 0;if(!this.isMouseDown&&!a.some(e=>e.isMouseDown)){let r=this.GetMaxLayer(e,t,s,a);if(this.isInside(e,t,r,s)){if((this.isLeftResizeEW(e,s)||this.isRightResizeEW(e,s))&&this.isYResizeEW(t,s))this.statesKeeper.serialNumberResizeEW=this.rect.serialNumber,i.dataset.cursor="ew-resize",this.isResize=!0,this.isResizeEW=!0,this.statesKeeper.directResizing=this.isLeftResizeEW(e,s)?y.EastWestLeft:y.EastWestRight;else if((this.isTopResizeNS(t,s)||this.isDownResizeNS(t,s))&&this.isXResizeNS(e,s))this.statesKeeper.serialNumberResizeNS=this.rect.serialNumber,i.dataset.cursor="ns-resize",this.isResize=!0,this.isResizeNS=!0,this.statesKeeper.directResizing=this.isTopResizeNS(t,s)?y.NorthSouthTop:y.NorthSouthDown;else if(this.isResizeNESWTopRight(e,t,s))this.statesKeeper.serialNumberResizeNESW=this.rect.serialNumber,i.dataset.cursor="nesw-resize",this.isResize=!0,this.isResizeNESW=!0,this.statesKeeper.directResizing=y.NESWTopRight;else if(this.isResizeNESWBottomLeft(e,t,s))this.statesKeeper.serialNumberResizeNESW=this.rect.serialNumber,i.dataset.cursor="nesw-resize",this.isResize=!0,this.isResizeNESW=!0,this.statesKeeper.directResizing=y.NESWBootomLeft;else if(this.isResizeNWSELeftTop(e,t,s))this.statesKeeper.serialNumberResizeNESW=this.rect.serialNumber,i.dataset.cursor="nwse-resize",this.isResize=!0,this.isResizeNWSE=!0,this.statesKeeper.directResizing=y.NWSELeftTop;else if(this.isResizeNWSERightBottom(e,t,s))this.statesKeeper.serialNumberResizeNESW=this.rect.serialNumber,i.dataset.cursor="nwse-resize",this.isResize=!0,this.isResizeNWSE=!0,this.statesKeeper.directResizing=y.NWSERightBottom;else if(this.isCloseButton(e,t)){this.ResetMoveMouse(i),this.statesKeeper.serialNumberHoverClose=this.rect.serialNumber;let e=i.getContext("2d");this.DrawHeaderHoverClose(e,this.GetFontSize(e))}else if(this.isMinimizeButton(e,t)){this.ResetMoveMouse(i),this.statesKeeper.serialNumberHoverMinimize=this.rect.serialNumber;let e=i.getContext("2d");this.DrawHeaderHoverMinimize(e,this.GetFontSize(e))}else if(!this.isMaximize&&this.isMaximizeButton(e,t)){this.ResetMoveMouse(i),this.statesKeeper.serialNumberHoverMaximize=this.rect.serialNumber;let e=i.getContext("2d");this.DrawHeaderHoverMaximize(e,this.GetFontSize(e))}else if(this.isMaximize&&this.isRestoreDownButton(e,t)){this.ResetMoveMouse(i),this.statesKeeper.serialNumberHoverRestoreDown=this.rect.serialNumber;let e=i.getContext("2d");this.DrawHeaderHoverRestoreDown(e,this.GetFontSize(e))}else this.statesKeeper.Clear(),this.ResizeOff(),this.ResetMoveMouse(i),i.dataset.cursor="default";return c.instance.serialNumberTracking=this.rect.serialNumber,this.rect.serialNumber}return this.ResetMoveMouse(i),0}if(this.isMouseDown){let s=!1;if(this.isResize&&this.isResizeEW&&this.statesKeeper.directResizing==y.EastWestLeft)e>0&&e<this.rect.x+this.rect.width-Math.max(u.figureWidthMin,this.GetMinCaptionWidth())&&this.rect.x!==e&&(e<this.rect.x&&(this.rect.width+=this.rect.x-e),e>this.rect.x&&(this.rect.width-=e-this.rect.x),this.rect.x=e,document.dispatchEvent(new CustomEvent("mwsmIsResize",{bubbles:!0})));else if(this.isResize&&this.isResizeEW&&this.statesKeeper.directResizing==y.EastWestRight)e>this.rect.x+Math.max(u.figureWidthMin,this.GetMinCaptionWidth())&&e<i.width&&this.rect.x+this.rect.width!==e&&(this.rect.width=e-this.rect.x,document.dispatchEvent(new CustomEvent("mwsmIsResize",{bubbles:!0}))),document.dispatchEvent(new CustomEvent("mwsmIsResize",{bubbles:!0}));else if(this.isResize&&this.isResizeNS&&this.statesKeeper.directResizing==y.NorthSouthTop)t>0&&t<this.rect.y+this.rect.height-(this.fontSize+2)-2*this.rect.borderWidth-5&&t!==this.rect.y&&(t<this.rect.y&&(this.rect.height+=this.rect.y-t),t>this.rect.y&&(this.rect.height-=t-this.rect.y),this.rect.y=t,document.dispatchEvent(new CustomEvent("mwsmIsResize",{bubbles:!0})));else if(this.isResize&&this.isResizeNS&&this.statesKeeper.directResizing==y.NorthSouthDown)t>this.rect.y+(this.fontSize+2)+2*this.rect.borderWidth+5&&t<i.height&&t!==this.rect.y+this.rect.height&&(this.rect.height=t-this.rect.y,document.dispatchEvent(new CustomEvent("mwsmIsResize",{bubbles:!0})));else if(this.isResize&&this.isResizeNESW&&this.statesKeeper.directResizing==y.NESWTopRight)s=!1,e>this.rect.x+Math.max(u.figureWidthMin,this.GetMinCaptionWidth())&&e<i.width&&this.rect.x+this.rect.width!==e&&(this.rect.width=e-this.rect.x,s=!0),t>0&&t<this.rect.y+this.rect.height-(this.fontSize+2)-2*this.rect.borderWidth-5&&t!==this.rect.y&&(t<this.rect.y&&(this.rect.height+=this.rect.y-t),t>this.rect.y&&(this.rect.height-=t-this.rect.y),this.rect.y=t,s=!0),s&&document.dispatchEvent(new CustomEvent("mwsmIsResize",{bubbles:!0}));else if(this.isResize&&this.isResizeNESW&&this.statesKeeper.directResizing==y.NESWBootomLeft)s=!1,e>0&&e<this.rect.x+this.rect.width-Math.max(u.figureWidthMin,this.GetMinCaptionWidth())&&this.rect.x!==e&&(e<this.rect.x&&(this.rect.width+=this.rect.x-e),e>this.rect.x&&(this.rect.width-=e-this.rect.x),this.rect.x=e,s=!0),t>this.rect.y+(this.fontSize+2)+2*this.rect.borderWidth+5&&t<i.height&&t!==this.rect.y+this.rect.height&&(this.rect.height=t-this.rect.y,s=!0),s&&document.dispatchEvent(new CustomEvent("mwsmIsResize",{bubbles:!0}));else if(this.isResize&&this.isResizeNWSE&&this.statesKeeper.directResizing==y.NWSELeftTop)s=!1,e>0&&e<this.rect.x+this.rect.width-Math.max(u.figureWidthMin,this.GetMinCaptionWidth())&&this.rect.x!==e&&(e<this.rect.x&&(this.rect.width+=this.rect.x-e),e>this.rect.x&&(this.rect.width-=e-this.rect.x),this.rect.x=e,s=!0),t>0&&t<this.rect.y+this.rect.height-(this.fontSize+2)-2*this.rect.borderWidth-5&&t!==this.rect.y&&(t<this.rect.y&&(this.rect.height+=this.rect.y-t),t>this.rect.y&&(this.rect.height-=t-this.rect.y),this.rect.y=t,s=!0),s&&document.dispatchEvent(new CustomEvent("mwsmIsResize",{bubbles:!0}));else if(this.isResize&&this.isResizeNWSE&&this.statesKeeper.directResizing==y.NWSERightBottom)s=!1,e>this.rect.x+Math.max(u.figureWidthMin,this.GetMinCaptionWidth())&&e<i.width&&this.rect.x+this.rect.width!==e&&(this.rect.width=e-this.rect.x,s=!0),t>this.rect.y+(this.fontSize+2)+2*this.rect.borderWidth+5&&t<i.height&&t!==this.rect.y+this.rect.height&&(this.rect.height=t-this.rect.y,s=!0),s&&document.dispatchEvent(new CustomEvent("mwsmIsResize",{bubbles:!0}));else{let s=e-this.startMove.x,a=t-this.startMove.y;this.newMove.x=this.rect.x+s,this.newMove.y=this.rect.y+a,this.newMove.x>0&&this.newMove.y>0&&this.newMove.x+this.rect.width<=i.width&&this.newMove.y+this.rect.height<=i.height&&(this.rect.x=this.newMove.x,this.rect.y=this.newMove.y,this.startMove.x=e,this.startMove.y=t,document.dispatchEvent(new CustomEvent("mwsmIsMove",{bubbles:!0})))}return this.rect.serialNumber}}mouseUpHandler(e,t,i,s,a){if(this.isMinimize)return 0;if(!this.isMouseDown&&!a.some(e=>e.isMouseDown)){let i=this.GetMaxLayer(e,t,s,a);return this.isInside(e,t,i,s)?(c.instance.serialNumberTracking=this.rect.serialNumber,this._isMouseDown=!1,this.rect.serialNumber):0}return this.isMouseDown?(this.statesKeeper.Clear(),this.isResize&&(this.ResizeOff(),i.dataset.cursor="default"),this._isMouseDown=!1,0):void 0}mouseClickHandler(e,t,i,s,a){if(this.isMinimize)return 0;let r=this.GetMaxLayer(e,t,s,a);return this.isInside(e,t,r,s)?(c.instance.serialNumberTracking=this.rect.serialNumber,this.isCloseButton(e,t)&&this.statesKeeper.serialNumberHoverClose==this.rect.serialNumber?document.dispatchEvent(new CustomEvent("mwsm-CLose-click",{bubbles:!0,detail:{serialNumber:this.rect.serialNumber}})):this.isMinimizeButton(e,t)&&this.statesKeeper.serialNumberHoverMinimize==this.rect.serialNumber?document.dispatchEvent(new CustomEvent("mwsm-Minimize-click",{bubbles:!0,detail:{serialNumber:this.rect.serialNumber}})):!this.isMaximize&&this.isMaximizeButton(e,t)&&this.statesKeeper.serialNumberHoverMaximize==this.rect.serialNumber?document.dispatchEvent(new CustomEvent("mwsm-Maxmize-click",{bubbles:!0,detail:{serialNumber:this.rect.serialNumber}})):this.isMaximize&&this.isRestoreDownButton(e,t)&&this.statesKeeper.serialNumberHoverRestoreDown==this.rect.serialNumber&&document.dispatchEvent(new CustomEvent("mwsm-RestoreDown-click",{bubbles:!0,detail:{serialNumber:this.rect.serialNumber}})),this.rect.serialNumber):0}SetRecoveryParameters(){this.recoveryParameters.x=this.rect.x,this.recoveryParameters.y=this.rect.y,this.recoveryParameters.width=this.rect.width,this.recoveryParameters.height=this.rect.height}DefineEvents(){document.addEventListener("mwsmIsResize",()=>{this.rect.isSelected&&this.SetRecoveryParameters()},!1),document.addEventListener("mwsmIsMove",()=>{this.rect.isSelected&&this.SetRecoveryParameters()},!1),document.addEventListener(c.instance.nameEventWPropStoredWidthChanged,()=>{this.rect.isSelected&&this.SetRecoveryParameters()},!1),document.addEventListener(c.instance.nameEventWPropStoredHeightChanged,()=>{this.rect.isSelected&&this.SetRecoveryParameters()},!1)}SetRectWave(){this._rectWave.x=this.rect.x,this._rectWave.y=this.rect.y+this.headerHeight,this._rectWave.width=this.rect.width,this._rectWave.height=this.rect.height-this.headerHeight}drawHeader(e,t){let i=this.GetFontSize(e);this.headerHeight=i+2,e.clearRect(this.rect.x,this.rect.y,this.rect.width,this.headerHeight),e.beginPath(),e.rect(this.rect.x,this.rect.y,this.rect.width,this.headerHeight),e.fillStyle="hsl(0,0%,75%)",e.fill(),e.font=i+"px Roboto Condensed",this.rect.isSelected?e.fillStyle="black":e.fillStyle="gray",e.textAlign="left",e.textBaseline="top";let s=`${this.rect.serialNumber}-${t}`;e.fillText(s,this.rect.x+1,this.rect.y+1),this.DrawHeaderClose(e,i),this.isMaximize?this.DrawHeaderRestoreDown(e,i):this.DrawHeaderMaximize(e,i),this.DrawHeaderMinimize(e,i)}DrawHeaderMinimize(e,t){e.font=t+"px Roboto Condensed",e.textAlign="right",e.fillText("‒",this.rect.x+this.rect.width-M.instance.sizeResizingZone-this.measureCaptionClose.width-2*M.instance.sizeResizingZone-this.measureCaptionMaximize.width-2*M.instance.sizeResizingZone,this.rect.y+1)}DrawHeaderMaximize(e,t){e.font=t+"px Webdings",e.textAlign="right",e.fillText("1",this.rect.x+this.rect.width-M.instance.sizeResizingZone-this.measureCaptionClose.width-2*M.instance.sizeResizingZone,this.rect.y+1)}DrawHeaderRestoreDown(e,t){e.font=t+"px Webdings",e.textAlign="right",e.fillText("2",this.rect.x+this.rect.width-M.instance.sizeResizingZone-this.measureCaptionClose.width-2*M.instance.sizeResizingZone,this.rect.y+1)}DrawHeaderClose(e,t){e.font=t+"px Symbol",e.textAlign="right",e.fillText("´",this.rect.x+this.rect.width-M.instance.sizeResizingZone,this.rect.y+1)}DrawHeaderHoverClose(e,t,i=!0){let s=2*M.instance.sizeResizingZone+this.measureCaptionClose.width;e.beginPath(),e.rect(this.rect.x+this.rect.width-s,this.rect.y,s,this.headerHeight),e.fillStyle=i?"hsl(0,0%,90%)":"hsl(0,0%,75%)",e.fill(),e.closePath(),this.rect.isSelected?e.fillStyle="black":e.fillStyle="gray",e.font=t+"px Symbol",e.textAlign="right",e.textBaseline="top",e.fillText("´",this.rect.x+this.rect.width-M.instance.sizeResizingZone,this.rect.y+1)}DrawHeaderHoverMinimize(e,t,i=!0){let s=2*M.instance.sizeResizingZone+this.measureCaptionMinimize.width,a=this.isMaximize?this.measureCaptionRestoreDown.width:this.measureCaptionMaximize.width,r=2*M.instance.sizeResizingZone;e.beginPath(),e.rect(this.rect.x+this.rect.width-r-this.measureCaptionClose.width-r-a-s,this.rect.y,s,this.headerHeight),e.fillStyle=i?"hsl(0,0%,90%)":"hsl(0,0%,75%)",e.fill(),e.closePath(),this.rect.isSelected?e.fillStyle="black":e.fillStyle="gray",e.font=t+"px Roboto Condensed",e.textAlign="right",e.textBaseline="top",e.fillText("‒",this.rect.x+this.rect.width-r-this.measureCaptionClose.width-r-a-M.instance.sizeResizingZone,this.rect.y+1)}DrawHeaderHoverMaximize(e,t,i=!0){let s=2*M.instance.sizeResizingZone+this.measureCaptionMaximize.width,a=2*M.instance.sizeResizingZone;e.beginPath(),e.rect(this.rect.x+this.rect.width-a-this.measureCaptionClose.width-s,this.rect.y,s,this.headerHeight),e.fillStyle=i?"hsl(0,0%,90%)":"hsl(0,0%,75%)",e.fill(),e.closePath(),this.rect.isSelected?e.fillStyle="black":e.fillStyle="gray",e.font=t+"px Webdings",e.textAlign="right",e.textBaseline="top",e.fillText("1",this.rect.x+this.rect.width-a-this.measureCaptionClose.width-M.instance.sizeResizingZone,this.rect.y+1)}DrawHeaderHoverRestoreDown(e,t,i=!0){let s=2*M.instance.sizeResizingZone+this.measureCaptionRestoreDown.width,a=2*M.instance.sizeResizingZone;e.beginPath(),e.rect(this.rect.x+this.rect.width-a-this.measureCaptionClose.width-s,this.rect.y,s,this.headerHeight),e.fillStyle=i?"hsl(0,0%,90%)":"hsl(0,0%,75%)",e.fill(),e.closePath(),this.rect.isSelected?e.fillStyle="black":e.fillStyle="gray",e.font=t+"px Webdings",e.textAlign="right",e.textBaseline="top",e.fillText("2",this.rect.x+this.rect.width-a-this.measureCaptionClose.width-M.instance.sizeResizingZone,this.rect.y+1)}ResetMoveMouse(e){if(this.statesKeeper.serialNumberResizeEW===this.rect.serialNumber)this.statesKeeper.serialNumberResizeEW=0,e.dataset.cursor="default";else if(this.statesKeeper.serialNumberResizeNS===this.rect.serialNumber)this.statesKeeper.serialNumberResizeNS=0,e.dataset.cursor="default";else if(this.statesKeeper.serialNumberResizeNESW===this.rect.serialNumber)this.statesKeeper.serialNumberResizeNESW=0,e.dataset.cursor="default";else if(this.statesKeeper.serialNumberResizeNWSE===this.rect.serialNumber)this.statesKeeper.serialNumberResizeNWSE=0,e.dataset.cursor="default";else if(this.statesKeeper.serialNumberHoverClose===this.rect.serialNumber){this.statesKeeper.serialNumberHoverClose=0;let t=e.getContext("2d");this.DrawHeaderHoverClose(t,this.GetFontSize(t),!1)}else if(this.statesKeeper.serialNumberHoverMinimize===this.rect.serialNumber){this.statesKeeper.serialNumberHoverMinimize=0;let t=e.getContext("2d");this.DrawHeaderHoverMinimize(t,this.GetFontSize(t),!1)}else if(this.statesKeeper.serialNumberHoverMaximize===this.rect.serialNumber){this.statesKeeper.serialNumberHoverMaximize=0;let t=e.getContext("2d");this.DrawHeaderHoverMaximize(t,this.GetFontSize(t),!1)}else if(this.statesKeeper.serialNumberHoverRestoreDown===this.rect.serialNumber){this.statesKeeper.serialNumberHoverRestoreDown=0;let t=e.getContext("2d");this.DrawHeaderHoverRestoreDown(t,this.GetFontSize(t),!1)}}GetMaxLayer(e,t,i,s){let a=0,r=0,n=new Array;for(let a=0;a<s.length;a++){let r=s[a];r.isMinimize||e>=r.rect.x-i&&e<=r.rect.x+r.rect.width+i&&t>=r.rect.y-i&&t<=r.rect.y+r.rect.height+i&&n.push([a,r.rect.serialNumber])}return n.length>1?(a=n.reduce((e,t)=>t[0]>e?t[0]:e,0),r=n.find(e=>e[0]===a)[1]):1===n.length&&(r=n[0][1]),r}ResizeOff(){this.isResize=!1,this.isResizeEW=!1,this.isResizeNS=!1,this.isResizeNESW=!1,this.isResizeNWSE=!1}isInside(e,t,i,s){return this.rect.serialNumber===i&&(e>=this.rect.x-s&&e<=this.rect.x+this.rect.width+s&&t>=this.rect.y-s&&t<=this.rect.y+this.rect.height+s)}isLeftResizeEW(e,t){return e>=this.rect.x-t&&e<=this.rect.x}isRightResizeEW(e,t){return e>=this.rect.x+this.rect.width&&e<=this.rect.x+this.rect.width+t}isYResizeEW(e,t){return e>=this.rect.y+t&&e<=this.rect.y+this.rect.height-t}isTopResizeNS(e,t){return e>=this.rect.y-t&&e<=this.rect.y}isDownResizeNS(e,t){return e>=this.rect.y+this.rect.height&&e<=this.rect.y+this.rect.height+t}isXResizeNS(e,t){return e>=this.rect.x+t&&e<=this.rect.x+this.rect.width-t}isResizeNESWTopRight(e,t,i){return e>=this.rect.x+this.rect.width&&e<=this.rect.x+this.rect.width+i&&t>=this.rect.y-i&&t<=this.rect.y}isResizeNESWBottomLeft(e,t,i){return e>=this.rect.x-i&&e<=this.rect.x&&t>=this.rect.y+this.rect.height&&t<=this.rect.y+this.rect.height+i}isResizeNWSELeftTop(e,t,i){return e>=this.rect.x-i&&e<=this.rect.x&&t>=this.rect.y-i&&t<=this.rect.y}isResizeNWSERightBottom(e,t,i){return e>=this.rect.x+this.rect.width&&e<=this.rect.x+this.rect.width+i&&t>=this.rect.y+this.rect.height&&t<=this.rect.y+this.rect.height+i}isMinimizeButton(e,t){let i=this.isMaximize?this.measureCaptionRestoreDown.width:this.measureCaptionMaximize.width,s=2*M.instance.sizeResizingZone;return e>this.rect.x+this.rect.width-s-this.measureCaptionClose.width-s-i-s-this.measureCaptionMinimize.width+1&&e<this.rect.x+this.rect.width-s-this.measureCaptionClose.width-s-i-1&&t>this.rect.y+1&&t<this.rect.y+this.headerHeight-1}isMaximizeButton(e,t){let i=2*M.instance.sizeResizingZone;return e>this.rect.x+this.rect.width-i-this.measureCaptionClose.width-i-this.measureCaptionMaximize.width+1&&e<this.rect.x+this.rect.width-i-this.measureCaptionClose.width-1&&t>this.rect.y+1&&t<this.rect.y+this.headerHeight-1}isRestoreDownButton(e,t){let i=2*M.instance.sizeResizingZone;return e>this.rect.x+this.rect.width-i-this.measureCaptionClose.width-i-this.measureCaptionRestoreDown.width+1&&e<this.rect.x+this.rect.width-i-this.measureCaptionClose.width-1&&t>this.rect.y+1&&t<this.rect.y+this.headerHeight-1}isCloseButton(e,t){return e>this.rect.x+this.rect.width-2*M.instance.sizeResizingZone-this.measureCaptionClose.width+1&&e<this.rect.x+this.rect.width-1&&t>this.rect.y+1&&t<this.rect.y+this.headerHeight-1}GetMinCaptionWidth(){return Math.floor(1+this.measureCaptionHead.width+2*M.instance.sizeResizingZone+this.measureCaptionMinimize.width+2*M.instance.sizeResizingZone+this.measureCaptionMaximize.width+2*M.instance.sizeResizingZone+this.measureCaptionClose.width+M.instance.sizeResizingZone)}GetFontSize(e){let t=Math.floor(e.canvas.height/30);return t<10?10:t}}class N extends z{constructor(e,t,i){super(e),this._rect=new C(e.x,e.y,e.width,t[0],t[1],i),this.fillType=Array.from(n.entries()).find(e=>"Цветная"==e[0]),this.calcStandardProportions()}get rect(){return this._rect}draw(e){this.drawHeader(e,this.rect.country),this.calcStandardProportions(),e.globalAlpha=1,e.beginPath(),e.rect(this.rect.x,this.rect.y+this.headerHeight,this.rect.width,this.rect.height-this.headerHeight),e.fillStyle=this.colorStroke,e.fill(),this.rect.isLoad&&(this.SetRectWave(),e.drawImage(this.rect.img,0,0,this.rect.img.width,this.rect.img.height,this._rectWave.x,this._rectWave.y,this._rectWave.width,this._rectWave.height),this._contextData=e.getImageData(this._rectWave.x,this._rectWave.y,this._rectWave.width,this._rectWave.height).data),this.rect.isLoad||Object(s.b)(()=>this.draw(e))}SetRectWave(){this._rectWave.x=this.rect.insideX,this._rectWave.y=this.rect.insideY,this._rectWave.width=this.rect.insideWidth,this._rectWave.height=this.rect.insideHeight}calcStandardProportions(){this.rect.height=Math.floor(this.rect.width/this.rect.aspectRatio),this.rect.insideX=this.rect.x+this.rect.borderWidth,this.rect.insideY=this.rect.y+this.headerHeight+this.rect.borderWidth,this.rect.insideWidth=Math.ceil(this.rect.width-2*this.rect.borderWidth),this.rect.insideHeight=Math.ceil(this.rect.height-this.headerHeight-2*this.rect.borderWidth)}}let W=(()=>{class e{constructor(e,t,i,s){this._bufferCanvas=document.createElement("canvas"),this._bufferContext=this._bufferCanvas.getContext("2d"),this._windows=[],this._canvasEventHandlers=new I,this._localKeyList=new x,this._localValueList=new R,this._mwsArea=e,this._context=this._mwsArea.getContext("2d"),this._mwsmStart=t,this._menuStart=i,this._mwsmTaskBar=s,this.DefineEvents(),this.InitScaleArea(),this.LoadWindows(),this.Draw(!0),this.CreateTaskBar()}static get instance(){if(!e._instance)throw new Error("Instance of ViewMWS was not created.");return e._instance}get mwsArea(){return this._mwsArea}get context(){return this._context}get windows(){return this._windows}get fillType(){let e=c.instance.wPropStored.fillType;if("Любая"===e[0]){let t=a.a.instance.RandomInt(1,n.size-1);e=Array.from(n.entries()).find(e=>e[1]==t)}return e}static Create(t,i,s,a){return e._instance||(e._instance=new e(t,i,s,a)),e._instance}getCoordinates(e){let t,i,s,a,r=e.target.getBoundingClientRect();return t=e.clientX-Math.floor(r.left),i=e.clientY-Math.floor(r.top),s=Math.floor(e.target.width/r.width*t),a=Math.floor(e.target.height/r.height*i),{x:s,y:a}}drawStar(e,t,i,s,a,r=3,n="blue",h="yellow"){let o=Math.PI/2*3,l=e,d=t,m=Math.PI/i;this.context.strokeStyle="#000",this.context.beginPath(),this.context.moveTo(e,t-s);for(let r=0;r<i;r++)l=e+Math.cos(o)*s,d=t+Math.sin(o)*s,this.context.lineTo(l,d),o+=m,l=e+Math.cos(o)*a,d=t+Math.sin(o)*a,this.context.lineTo(l,d),o+=m;this.context.lineTo(e,t-s),this.context.closePath(),this.context.lineWidth=r,this.context.strokeStyle=n,this.context.stroke(),this.context.fillStyle=h,this.context.fill()}Redraw(){this.Draw()}Draw(e=!1){if(this.context.globalAlpha=1,e){let e=this.windows.filter(e=>"flag"==e.rect.kind[0]);e.length>0?e.every(e=>e.rect.isLoad)?(this.context.clearRect(0,0,this.mwsArea.width,this.mwsArea.height),this.ShowWindows(this.context)):Object(s.b)(()=>this.Draw(!0)):(this.context.clearRect(0,0,this.mwsArea.width,this.mwsArea.height),this.ShowWindows(this.context))}else this._bufferContext.clearRect(0,0,this._bufferCanvas.width,this._bufferCanvas.height),this.ShowWindows(this._bufferContext),this.context.clearRect(0,0,this.mwsArea.width,this.mwsArea.height),this.context.drawImage(this._bufferCanvas,0,0)}ShowWindows(e){for(let t of this.windows.filter(e=>!e.isMinimize))t.draw(e)}DefineEvents(){this.mwsArea.addEventListener("mousedown",e=>{this.OnMouseDownCanvas(e)},!1),this.mwsArea.addEventListener("mousemove",e=>{this.OnMouseMoveCanvas(e)},!1),this.mwsArea.addEventListener("mouseup",e=>{this.OnMouseUpCanvas(e)},!1),this.mwsArea.addEventListener("click",e=>{this.OnMouseClickCanvas(e)},!1),this._mwsmStart.addEventListener("click",e=>{this.OnStart(e)},!1);for(let e of document.getElementsByName("mwsm-task"))e.addEventListener("click",e=>{this.OnTaskStart(e)},!0);document.addEventListener(c.instance.nameEventFillChange,()=>{this.OnFillChange()},!1),document.addEventListener(c.instance.nameEventScaleChange,()=>{this.OnScaleChange()},!1),document.addEventListener("CustomEventOverFill",()=>{this.OnOverFill()},!1),document.addEventListener("CustomEventIsSelected",e=>{this.OnIsSelected(e)},!1),document.addEventListener("mwsmIsResize",()=>{this.OnIsResize()},!1),document.addEventListener("mwsmIsMove",()=>{this.OnIsMove()},!1),document.addEventListener(c.instance.nameEventWPropStoredWidthChanged,e=>{this.OnChangeSelectedWidth(e)},!1),document.addEventListener(c.instance.nameEventWPropStoredHeightChanged,e=>{this.OnChangeSelectedHeight(e)},!1),document.addEventListener(c.instance.nameEventWPropStoredLengthWaveChanged,e=>{this.OnChangeSelectedLengthWave(e)},!1),document.addEventListener(c.instance.nameEventWPropStoredAmplitudeWaveChanged,e=>{this.OnChangeSelectedAmplitudeWave(e)},!1),document.addEventListener(c.instance.nameEventWPropStoredPeriodWaveChanged,e=>{this.OnChangeSelectedPeriodWave(e)},!1),document.addEventListener(c.instance.nameEventWPropStoredShadingWaveChanged,e=>{this.OnChangeSelectedShadingWave(e)},!1),document.addEventListener("mwsm-CLose-click",e=>{this.OnCloseClick(e)},!1),document.addEventListener("mwsm-Minimize-click",e=>{this.OnMinimizeClick(e)},!1),document.addEventListener("mwsm-Maxmize-click",e=>{this.OnMaximizeClick(e)},!1),document.addEventListener("mwsm-RestoreDown-click",e=>{this.OnRestoreDownClick(e)},!1),document.addEventListener("mwsm-change-status-wave-motion",()=>{this.OnChangeStatusWaveMotion()},!1),window.addEventListener("resize",()=>{this.OnWindowChange()},!1),window.addEventListener("scroll",()=>{this.OnWindowChange()},!1)}InitScaleArea(){if(!c.instance.isOffScreenCanvas){switch(this._mwsArea.width=c.instance.scale[1],this._mwsArea.height=Math.round(this._mwsArea.width/2),this._bufferCanvas.width=this._mwsArea.width,this._bufferCanvas.height=this._mwsArea.height,this._mwsArea.width){case 300:c.instance.sizeResizingZone=6;break;case 600:c.instance.sizeResizingZone=7;break;case 900:c.instance.sizeResizingZone=8;break;case 1200:c.instance.sizeResizingZone=9;break;case 1600:c.instance.sizeResizingZone=10;break;case 1900:c.instance.sizeResizingZone=11;break;case 2560:c.instance.sizeResizingZone=14;break;case 3200:c.instance.sizeResizingZone=16;break;case 4800:c.instance.sizeResizingZone=18;break;case 5600:c.instance.sizeResizingZone=20}M.instance.sizeResizingZone=c.instance.sizeResizingZone}}AddToList(e,t=["",""],i=2){let s,r=this.windows.reduce((e,t)=>t.rect.serialNumber>e?t.rect.serialNumber:e,0)+1,h=this.GetFontSize();switch(e[0]){case"rectangle":{this._context.font=h+"px Roboto Condensed";let e=r+"-rectangle",t=this.context.measureText(e);this._context.font=h+"px Symbol";let i=this.context.measureText("´");this._context.font=h+"px Roboto Condensed";let n=this.context.measureText("‒");this._context.font=h+"px Webdings";let o=this.context.measureText("1");this._context.font=h+"px Webdings";let l=this.context.measureText("2"),d=a.a.instance.RandomInt(Math.max(u.figureWidthMin,Math.floor(t.width+2*c.instance.sizeResizingZone+n.width+2*c.instance.sizeResizingZone+o.width+2*c.instance.sizeResizingZone+i.width+c.instance.sizeResizingZone)),Math.min(Math.floor(this.mwsArea.width/2),u.figureWidthMax)),m=a.a.instance.RandomInt(u.figureHeightMin+h+2,Math.min(Math.floor(this.mwsArea.height/4),u.figureHeightMax));s=new z(new f(a.a.instance.RandomInt(1,Math.floor(this.mwsArea.width)-d),a.a.instance.RandomInt(1,Math.floor(this.mwsArea.height)-m-(h-2)),d,m,a.a.instance.RandomInt(Math.floor(.05*m),Math.floor(.15*m))),a.a.instance.randomColor,a.a.instance.randomColor),s.rect.serialNumber=r,s.measureCaptionHead=t,s.measureCaptionClose=i,s.measureCaptionMinimize=n,s.measureCaptionMaximize=o,s.measureCaptionRestoreDown=l,s.fontSize=h,this.NewFill(s),s.SetRecoveryParameters(),this.windows.push(s),this._canvasEventHandlers.mouseDown.set(r,(e,t,i,a,r)=>s.mouseDownHandler(e,t,i,a,r)),this._canvasEventHandlers.mouseMove.set(r,(e,t,i,a,r)=>s.mouseMoveHandler(e,t,i,a,r)),this._canvasEventHandlers.mouseUp.set(r,(e,t,i,a,r)=>s.mouseUpHandler(e,t,i,a,r)),this._canvasEventHandlers.mouseClick.set(r,(e,t,i,a,r)=>s.mouseClickHandler(e,t,i,a,r));break}case"flag":{this._context.font=h+"px Roboto Condensed";let e=`${r}-${t[0]}`,o=this.context.measureText(e);this._context.font=h+"px Symbol";let l=this.context.measureText("´");this._context.font=h+"px Roboto Condensed";let d=this.context.measureText("‒");this._context.font=h+"px Webdings";let m=this.context.measureText("1");this._context.font=h+"px Webdings";let w=this.context.measureText("2"),g=a.a.instance.RandomInt(Math.max(u.figureWidthMin,Math.floor(o.width+2*c.instance.sizeResizingZone+d.width+2*c.instance.sizeResizingZone+m.width+2*c.instance.sizeResizingZone+l.width+c.instance.sizeResizingZone)),Math.min(Math.floor(this.mwsArea.width/2),u.figureWidthMax)),S=a.a.instance.RandomInt(u.figureHeightMin+h+2,Math.min(Math.floor(this.mwsArea.height/4),u.figureHeightMax));s=new N(new f(a.a.instance.RandomInt(1,Math.floor(this.mwsArea.width)-g),a.a.instance.RandomInt(1,Math.floor(this.mwsArea.height)-S-(h-2)),g,S,3),t,i),s.rect.serialNumber=r,s.measureCaptionHead=o,s.measureCaptionClose=l,s.measureCaptionMinimize=d,s.measureCaptionMaximize=m,s.measureCaptionRestoreDown=w,s.fontSize=h,s.fillType=Array.from(n.entries()).find(e=>"Цветная"==e[0]),s.SetRecoveryParameters(),this.windows.push(s),this._canvasEventHandlers.mouseDown.set(r,(e,t,i,a,r)=>s.mouseDownHandler(e,t,i,a,r)),this._canvasEventHandlers.mouseMove.set(r,(e,t,i,a,r)=>s.mouseMoveHandler(e,t,i,a,r)),this._canvasEventHandlers.mouseUp.set(r,(e,t,i,a,r)=>s.mouseUpHandler(e,t,i,a,r)),this._canvasEventHandlers.mouseClick.set(r,(e,t,i,a,r)=>s.mouseClickHandler(e,t,i,a,r));break}default:throw new Error("Error: Undefined kind of window")}}OnStart(e){let t=e.target;if(Object(s.a)(this._menuStart)&&"start"===this._menuStart.dataset.type)return void this.DisableMenuStart();this._menuStart.dataset.type="start";let i=t.getBoundingClientRect();this._menuStart.style.left=i.left+"px",this._menuStart.dataset.display="true";let a=this._menuStart.getBoundingClientRect();this._menuStart.style.top=i.top-a.height+"px"}OnTaskStart(e){let t=e.target.closest("[data-kind]"),i=t.dataset.kind;if("rectangle"==i)this.AddToList(Array.from(w.entries()).find(e=>"rectangle"===e[0])),this.DefinitionTask();else if("flag"==i){let e=S.find(e=>e.name==t.dataset.country);this.AddToList(Array.from(w.entries()).find(e=>"flag"===e[0]),[e.name,e.url],Number(t.dataset.aspectRatio)),this.DefinitionTask()}this.DisableMenuStart()}DefinitionTask(){c.instance.switchSerialNumber=this.windows[this.windows.length-1].rect.serialNumber,this.DefinePropStored(this.windows[this.windows.length-1]),this.SetNewTask()}OnFillChange(){this.SetFill()}NewFill(e){let t=a.a.instance.RandomInt(1,n.size-1),i=Array.from(n.entries()).find(e=>e[1]==t);this.InitFillViewRectangle(e,i)}InitFillViewRectangle(e,t){e.fillType=t,"Цветная"===e.fillType[0]?(e.colorStroke=a.a.instance.randomColor,e.colorFill=a.a.instance.randomColor):"Линейный градиент"===e.fillType[0]?(e.gradientBorder=a.a.instance.GetFillRectLineGradient(this.context,e.rect.x,e.rect.y,e.rect.width,e.rect.height,e.propertiesGradientBorder),e.gradientInside=a.a.instance.GetFillRectLineGradient(this.context,e.rect.x,e.rect.y,e.rect.width,e.rect.height,e.propertiesGradientInside)):"Радиальный градиент"===e.fillType[0]?(e.propertiesGradientBorder.radialDirection=a.a.instance.RandomInt(a.e.Centre,a.e.BottomTop),e.propertiesGradientBorder.colorScheme=a.a.instance.CreateColorScheme(),e.propertiesGradientInside.radialDirection=a.a.instance.RandomInt(a.e.Centre,a.e.BottomTop),e.propertiesGradientInside.colorScheme=a.a.instance.CreateColorScheme()):(e.fillType=Array.from(n.entries()).find(e=>"Цветная"===e[0]),e.colorStroke=a.a.instance.randomColor,e.colorFill=a.a.instance.randomColor)}OnScaleChange(){if(!c.instance.isOffScreenCanvas){let e=this.mwsArea.width,t=this.mwsArea.height;this.InitScaleArea();let i,s,a=this.mwsArea.width/e,r=this.mwsArea.height/t,n=this.GetFontSize();this.context.font=n+"px Symbol";let h=this.context.measureText("´");this.context.font=n+"px Roboto Condensed";let o=this.context.measureText("‒");this.context.font=n+"px Webdings";let l=this.context.measureText("1");this.context.font=n+"px Webdings";let d=this.context.measureText("2");for(let e of this.windows)e instanceof z&&(i=e.rect.serialNumber+"-rectangle",this.context.font=n+"px Roboto Condensed",s=this.context.measureText(i),e.rect.x=Math.floor(e.rect.x*a),e.rect.y=Math.floor(e.rect.y*r),e.rect.width=Math.floor(e.rect.width*a),e.rect.height=Math.floor(e.rect.height*r),e.rect.borderWidth=Math.floor(e.rect.borderWidth*r),e.measureCaptionHead=s,e.measureCaptionClose=h,e.measureCaptionMinimize=o,e.measureCaptionMaximize=l,e.measureCaptionRestoreDown=d,e.fontSize=n),e.rect.isSelected?this.DefinePropStored(e):this.UpdateValueList(e.rect.serialNumber);this.SaveWindows(),this.Draw()}}OnOverFill(){this.SetFill()}SetFill(){let e=this.windows[this.windows.length-1];e instanceof z&&(this.InitFillViewRectangle(e,this.fillType),this.DefinePropStored(e),e.isMinimize||e.draw(this.context),this.UpdateTaskBar("over-fill"))}OnMouseDownCanvas(e){let t,i=this.getCoordinates(e),s=!1,a=new Array;c.instance.canvasCoordinates=[i.x,i.y];for(let e of this._canvasEventHandlers.mouseDown.values())t=e(i.x,i.y,this.mwsArea,c.instance.sizeResizingZone,this.windows),t>0&&(a.push([this.windows.findIndex(e=>e.rect.serialNumber===t),t]),s=!0);if(s||(c.instance.serialNumberTracking=0),a.length>1){let e=a.reduce((e,t)=>t[0]>e?t[0]:e,0);c.instance.serialNumberTracking=a.find(t=>t[0]===e)[1]}}OnMouseMoveCanvas(e){let t,i=this.getCoordinates(e),s=!1;c.instance.canvasCoordinates=[i.x,i.y];for(let e of this._canvasEventHandlers.mouseMove.values())t=e(i.x,i.y,this.mwsArea,c.instance.sizeResizingZone,this.windows),t>0&&(s=!0);s||(c.instance.serialNumberTracking=0)}OnMouseUpCanvas(e){let t,i=this.getCoordinates(e),s=!1,a=new Array;c.instance.canvasCoordinates=[i.x,i.y];for(let e of this._canvasEventHandlers.mouseUp.values())t=e(i.x,i.y,this.mwsArea,c.instance.sizeResizingZone,this.windows),t>0&&(a.push([this.windows.findIndex(e=>e.rect.serialNumber===t),t]),s=!0);if(s||(c.instance.serialNumberTracking=0),a.length>1){let e=a.reduce((e,t)=>t[0]>e?t[0]:e,0);c.instance.serialNumberTracking=a.find(t=>t[0]===e)[1]}}OnMouseClickCanvas(e){let t,i=this.getCoordinates(e),s=!1;c.instance.canvasCoordinates=[i.x,i.y];for(let e of this._canvasEventHandlers.mouseClick.values())t=e(i.x,i.y,this.mwsArea,c.instance.sizeResizingZone,this.windows),t>0&&(s=!0);s||(c.instance.serialNumberTracking=0)}OnIsSelected(e){let t=e.detail.serialNumber,i=e.detail.x,s=e.detail.y,a=this.windows.findIndex(e=>e.rect.serialNumber===t),r=new Array;for(let e=0;e<this.windows.length;e++){let t=this.windows[e];i>=t.rect.x&&i<=t.rect.x+t.rect.width&&s>=t.rect.y&&s<=t.rect.y+t.rect.height&&r.push([e,t.rect.serialNumber])}r.length>1&&(a=r.reduce((e,t)=>t[0]>e?t[0]:e,0),t=r.find(e=>e[0]===a)[1]),c.instance.switchSerialNumber=t,this.SwitchToSelected()}SetNewTask(){let e=this.windows.find(e=>e.rect.serialNumber===c.instance.switchSerialNumber);if(this.windows.length>1){let t=this.windows.find(e=>e.rect.isSelected);t.rect.isSelected=!1,this.SaveUpdateValueList(t.rect.serialNumber);let i=this.windows.filter(e=>e.rect.serialNumber!==c.instance.switchSerialNumber);i.push(e),this._windows=i}e.rect.isSelected=!0,this.DefinePropStored(e),this.Draw(!0),this.UpdateTaskBar()}SwitchToSelected(){let e=this.windows.find(e=>e.rect.serialNumber===c.instance.switchSerialNumber);if(!e.rect.isSelected){if(this.windows.length>1){let t=this.windows.find(e=>e.rect.isSelected);t.rect.isSelected=!1,this.SaveUpdateValueList(t.rect.serialNumber);let i=this.windows.filter(e=>e.rect.serialNumber!==c.instance.switchSerialNumber);i.push(e),this._windows=i}e.rect.isSelected=!0,this.DefinePropStored(e),this.Draw(),document.dispatchEvent(new CustomEvent("CustomEventPermissionsIsSelected",{bubbles:!0,detail:{kind:e.rect.kind,isAnimate:e.rect.isAnimate}}))}this.UpdateTaskBar("selected")}OnIsResize(){this.Draw(),this.DefinePropStored(this.windows[this.windows.length-1])}OnIsMove(){this.Draw(),this.DefinePropStored(this.windows[this.windows.length-1])}OnChangeSelectedWidth(e){this.windows[this.windows.length-1].rect.width=e.detail.value,this.SaveUpdateValueList(this.windows[this.windows.length-1].rect.serialNumber),this.Draw()}OnChangeSelectedHeight(e){this.windows[this.windows.length-1].rect.height=e.detail.value,this.SaveUpdateValueList(this.windows[this.windows.length-1].rect.serialNumber),this.Draw()}OnChangeSelectedLengthWave(e){this.windows[this.windows.length-1].rect.waveParams.length=e.detail.value,this.SaveUpdateValueList(this.windows[this.windows.length-1].rect.serialNumber)}OnChangeSelectedAmplitudeWave(e){this.windows[this.windows.length-1].rect.waveParams.amplitude=e.detail.value,this.SaveUpdateValueList(this.windows[this.windows.length-1].rect.serialNumber)}OnChangeSelectedPeriodWave(e){this.windows[this.windows.length-1].rect.waveParams.period=e.detail.value,this.SaveUpdateValueList(this.windows[this.windows.length-1].rect.serialNumber)}OnChangeSelectedShadingWave(e){this.windows[this.windows.length-1].rect.waveParams.shading=e.detail.value,this.SaveUpdateValueList(this.windows[this.windows.length-1].rect.serialNumber)}OnCloseClick(e){let t=e.detail.serialNumber;this._canvasEventHandlers.mouseDown.delete(t),this._canvasEventHandlers.mouseMove.delete(t),this._canvasEventHandlers.mouseUp.delete(t),this._canvasEventHandlers.mouseClick.delete(t),this.windows.find(e=>e.rect.serialNumber==t).rect.isAnimate=!1;let i=this.windows.filter(e=>e.rect.serialNumber!=t);this._windows=i,this.windows.length>0&&!this.windows.some(e=>e.rect.isSelected)?(this.windows[this.windows.length-1].rect.isSelected=!0,this.DefinePropStored(this.windows[this.windows.length-1])):this.DefinePropStored(),this.Draw(),this.UpdateTaskBar(),this._localValueList.list=this._localValueList.list.filter(e=>e.serialNumber!=t),this.SaveWindows()}OnMinimizeClick(e){let t=e.detail.serialNumber,i=this.windows.find(e=>e.rect.serialNumber==t);i.isMinimize=!0,this.DefinePropStored(i),this.Draw()}OnMaximizeClick(e){let t=e.detail.serialNumber,i=this.windows.find(e=>e.rect.serialNumber==t);i.isMaximize=!0,this.DefinePropStored(i),i instanceof z&&(i.rect.x=0,i.rect.y=0,i.rect.width=this.mwsArea.width,i.rect.height=this.mwsArea.height),i.statesKeeper.serialNumberHoverMaximize=0,this.Draw()}OnRestoreDownClick(e){let t=e.detail.serialNumber,i=this.windows.find(e=>e.rect.serialNumber==t);i.isMaximize=!1,i instanceof z&&(i.rect.x=i.recoveryParameters.x,i.rect.y=i.recoveryParameters.y,i.rect.width=i.recoveryParameters.width,i.rect.height=i.recoveryParameters.height),i.statesKeeper.serialNumberHoverRestoreDown=0,this.DefinePropStored(i),this.Draw()}OnChangeStatusWaveMotion(){if(this.windows.length>0){let e=this.windows.find(e=>e.rect.isSelected);e.rect.isAnimate=!e.rect.isAnimate,e.rect.isAnimate&&e.wave(this.context)}}DefinePropStored(e=null){let t=new d;e&&(t=this.CreatePropStored(e)),c.instance.wPropStored=t,e&&this.SaveSelected()}CreatePropStored(e){let t=new d;if(t.x=e.rect.x,t.y=e.rect.y,t.kind=e.rect.kind,t.serialNumber=e.rect.serialNumber,t.isSelected=e.rect.isSelected,t.width=e.rect.width,t.widthOriginal=e.rect.widthOriginal,t.waveLength=e.rect.waveParams.length,t.waveAmplitude=e.rect.waveParams.amplitude,t.wavePeriod=e.rect.waveParams.period,t.waveShading=e.rect.waveParams.shading,t.height=e.rect.height,t.heightOriginal=e.rect.heightOriginal,t.borderWidth=e.rect.borderWidth,t.aspectRatio=e.rect.aspectRatio,t.headerHeight=e.headerHeight,t.measureCaptionHead=e.measureCaptionHead,t.measureCaptionClose=e.measureCaptionClose,t.measureCaptionMinimize=e.measureCaptionMinimize,t.measureCaptionMaximize=e.measureCaptionMaximize,t.measureCaptionRestoreDown=e.measureCaptionRestoreDown,t.fontsize=e.fontSize,t.isMaximize=e.isMaximize,t.isMinimize=e.isMinimize,t.recoveryParameters=JSON.parse(JSON.stringify(e.recoveryParameters)),e instanceof z&&(t.fillType=e.fillType,t.colorFill=e.colorFill,t.colorStroke=e.colorStroke,"Линейный градиент"==e.fillType[0]?(t.borderLinearDirection=e.propertiesGradientBorder.direction,t.insideLinearDirection=e.propertiesGradientInside.direction,t.borderColorScheme=e.propertiesGradientBorder.colorScheme.list.filter(()=>!0),t.insideColorScheme=e.propertiesGradientInside.colorScheme.list.filter(()=>!0)):"Радиальный градиент"==e.fillType[0]&&(t.borderRadialDirection=e.propertiesGradientBorder.radialDirection,t.insideRadialDirection=e.propertiesGradientInside.radialDirection,t.borderColorScheme=e.propertiesGradientBorder.colorScheme.list.filter(()=>!0),t.insideColorScheme=e.propertiesGradientInside.colorScheme.list.filter(()=>!0))),e instanceof N){let i=e;t.country=[i.rect.country,i.rect.url]}return t}OnWindowChange(){this.DisableMenuStart()}DisableMenuStart(){this._menuStart.dataset.type="empty",this._menuStart.dataset.display="false"}UpdateTaskBar(e="create"){switch(e){case"create":this.CreateTaskBar();break;case"selected":for(let e of this._mwsmTaskBar.querySelectorAll("[data-serial-number]")){Number(e.dataset.serialNumber)==c.instance.switchSerialNumber?e.dataset.selected="true":e.dataset.selected="false"}break;case"over-fill":let e=this.windows[this.windows.length-1];for(let t of this._mwsmTaskBar.querySelectorAll("[data-serial-number]")){if(Number(t.dataset.serialNumber)==e.rect.serialNumber){let i=t.querySelector("canvas");this.FillTaskBar(i,e);break}}}}CreateTaskBar(){this._mwsmTaskBar.innerHTML="";let e=this.windows.concat().sort((e,t)=>e.rect.serialNumber>t.rect.serialNumber?1:e.rect.serialNumber<t.rect.serialNumber?-1:0);for(let t of e){let e=document.createElement("div");e.className="mwsm-task",t.rect.isSelected?e.dataset.selected="true":e.dataset.selected="false",e.dataset.serialNumber=""+t.rect.serialNumber;let i=document.createElement("span");i.innerHTML=`&nbsp;${t.rect.serialNumber}&nbsp;`;let s=document.createElement("div");s.className="likeness",e.addEventListener("click",e=>{this.OnTaskSelected(e)},!1),e.appendChild(i),e.appendChild(s);let a=document.createElement("canvas");s.appendChild(a),this.FillTaskBar(a,t),this._mwsmTaskBar.appendChild(e)}}FillTaskBar(e,t){if("rectangle"==t.rect.kind[0])"Цветная"==t.fillType[0]?a.a.instance.FillSchemeColor(e.getContext("2d"),t.colorFill):"Линейный градиент"==t.fillType[0]?a.a.instance.FillSchemeLineGradient(e.getContext("2d"),t.propertiesGradientInside):"Радиальный градиент"==t.fillType[0]&&a.a.instance.FillSchemeRadialGradient(e.getContext("2d"),t.propertiesGradientInside);else if("flag"==t.rect.kind[0]){let i=t;e.getContext("2d").drawImage(i.rect.img,0,0,i.rect.img.width,i.rect.img.height,0,0,e.width,e.height)}}OnTaskSelected(e){let t=e.target.closest("[data-serial-number]"),i=Number(t.dataset.serialNumber),s=this.windows.find(e=>e.rect.serialNumber==i);"true"==t.dataset.selected?s.isMinimize&&(s.isMinimize=!1,t.scrollIntoView({block:"nearest",inline:"center",behavior:"smooth"}),this.Draw()):(s.isMinimize&&(s.isMinimize=!1),t.scrollIntoView({block:"nearest",inline:"center",behavior:"smooth"}),c.instance.switchSerialNumber=i,setTimeout(()=>{this.SwitchToSelected()},20))}GetFontSize(){let e=Math.floor(this.mwsArea.height/30);return e<10?10:e}SaveSelected(){if(this._localValueList.list.some(e=>e.serialNumber==c.instance.wPropStored.serialNumber)){let e=this._localValueList.list.findIndex(e=>e.serialNumber==c.instance.wPropStored.serialNumber);this._localValueList.list[e]=JSON.parse(JSON.stringify(c.instance.wPropStored))}else this._localValueList.list.push(JSON.parse(JSON.stringify(c.instance.wPropStored)));this.SaveWindows()}UpdateValueList(e){let t=this._localValueList.list.findIndex(t=>t.serialNumber==e);this._localValueList.list[t]=JSON.parse(JSON.stringify(this.CreatePropStored(this.windows.find(t=>t.rect.serialNumber==e))))}SaveWindows(){localStorage.setItem(JSON.stringify(this._localKeyList),JSON.stringify(this._localValueList))}LoadWindows(){if(localStorage.getItem(JSON.stringify(this._localKeyList))){this._localValueList=JSON.parse(localStorage.getItem(JSON.stringify(this._localKeyList)));let e=this.GetFontSize();for(let t of this._localValueList.list)switch(t.kind[0]){case"rectangle":{this._context.font=e+"px Roboto Condensed";let i=t.serialNumber+"-rectangle",s=this.context.measureText(i);this._context.font=e+"px Symbol";let r=this.context.measureText("´");this._context.font=e+"px Roboto Condensed";let h=this.context.measureText("‒");this._context.font=e+"px Webdings";let o=this.context.measureText("1");this._context.font=e+"px Webdings";let l=this.context.measureText("2"),d=new z(new f(t.x,t.y,t.width,t.height,t.borderWidth),a.a.instance.randomColor,a.a.instance.randomColor);d.rect.serialNumber=t.serialNumber,d.rect.isSelected=t.isSelected,d.isMaximize=t.isMaximize,d.isMinimize=t.isMinimize,d.measureCaptionHead=s,d.measureCaptionClose=r,d.measureCaptionMinimize=h,d.measureCaptionMaximize=o,d.measureCaptionRestoreDown=l,d.fontSize=e,d.SetRecoveryParameters(),d.rect.waveParams.length=t.waveLength,d.rect.waveParams.amplitude=t.waveAmplitude,d.rect.waveParams.period=t.wavePeriod,d.rect.waveParams.shading=t.waveShading,d.fillType=t.fillType,"Цветная"===t.fillType[0]?(d.colorStroke=t.colorStroke,d.colorFill=t.colorFill):"Линейный градиент"===t.fillType[0]?(d.propertiesGradientBorder.direction=t.borderLinearDirection,d.propertiesGradientInside.direction=t.insideLinearDirection,t.borderColorScheme.forEach(e=>d.propertiesGradientBorder.colorScheme.Add(e)),t.insideColorScheme.forEach(e=>d.propertiesGradientInside.colorScheme.Add(e))):"Радиальный градиент"===t.fillType[0]?(d.propertiesGradientBorder.radialDirection=t.borderRadialDirection,d.propertiesGradientInside.radialDirection=t.insideRadialDirection,t.borderColorScheme.forEach(e=>d.propertiesGradientBorder.colorScheme.Add(e)),t.insideColorScheme.forEach(e=>d.propertiesGradientInside.colorScheme.Add(e))):(d.fillType=Array.from(n.entries()).find(e=>"Цветная"===e[0]),d.colorStroke=a.a.instance.randomColor,d.colorFill=a.a.instance.randomColor),this.windows.push(d),this._canvasEventHandlers.mouseDown.set(t.serialNumber,(e,t,i,s,a)=>d.mouseDownHandler(e,t,i,s,a)),this._canvasEventHandlers.mouseMove.set(t.serialNumber,(e,t,i,s,a)=>d.mouseMoveHandler(e,t,i,s,a)),this._canvasEventHandlers.mouseUp.set(t.serialNumber,(e,t,i,s,a)=>d.mouseUpHandler(e,t,i,s,a)),this._canvasEventHandlers.mouseClick.set(t.serialNumber,(e,t,i,s,a)=>d.mouseClickHandler(e,t,i,s,a)),d.rect.isSelected&&(c.instance.switchSerialNumber=d.rect.serialNumber),d.isMaximize&&(d.rect.x=0,d.rect.y=0,d.rect.width=this.mwsArea.width,d.rect.height=this.mwsArea.height);break}case"flag":{this._context.font=e+"px Roboto Condensed";let i=`${t.serialNumber}-${t.country[0]}`,s=this.context.measureText(i);this._context.font=e+"px Symbol";let a=this.context.measureText("´");this._context.font=e+"px Roboto Condensed";let r=this.context.measureText("‒");this._context.font=e+"px Webdings";let n=this.context.measureText("1");this._context.font=e+"px Webdings";let h=this.context.measureText("2"),o=new N(new f(t.x,t.y,t.width,t.height,3),t.country,t.aspectRatio);o.rect.serialNumber=t.serialNumber,o.rect.isSelected=t.isSelected,o.isMaximize=t.isMaximize,o.isMinimize=t.isMinimize,o.measureCaptionHead=s,o.measureCaptionClose=a,o.measureCaptionMinimize=r,o.measureCaptionMaximize=n,o.measureCaptionRestoreDown=h,o.fontSize=e,o.SetRecoveryParameters(),o.rect.waveParams.length=t.waveLength,o.rect.waveParams.amplitude=t.waveAmplitude,o.rect.waveParams.period=t.wavePeriod,o.rect.waveParams.shading=t.waveShading,this.windows.push(o),this._canvasEventHandlers.mouseDown.set(t.serialNumber,(e,t,i,s,a)=>o.mouseDownHandler(e,t,i,s,a)),this._canvasEventHandlers.mouseMove.set(t.serialNumber,(e,t,i,s,a)=>o.mouseMoveHandler(e,t,i,s,a)),this._canvasEventHandlers.mouseUp.set(t.serialNumber,(e,t,i,s,a)=>o.mouseUpHandler(e,t,i,s,a)),this._canvasEventHandlers.mouseClick.set(t.serialNumber,(e,t,i,s,a)=>o.mouseClickHandler(e,t,i,s,a)),o.rect.isSelected&&(c.instance.switchSerialNumber=o.rect.serialNumber),o.isMaximize&&(o.rect.x=0,o.rect.y=0,o.rect.width=this.mwsArea.width,o.rect.height=this.mwsArea.height);break}default:throw new Error("Load rrror: Undefined kind of window")}if(c.instance.switchSerialNumber>0){let e=this.windows.find(e=>e.rect.serialNumber===c.instance.switchSerialNumber),t=this.windows.filter(e=>e.rect.serialNumber!==c.instance.switchSerialNumber);t.push(e),this._windows=t,this.DefinePropStored(e),document.dispatchEvent(new CustomEvent("CustomEventPermissionsIsSelected",{bubbles:!0,detail:{kind:e.rect.kind,isAnimate:e.rect.isAnimate}}))}}else for(let e=0;e<3;e++){let e=a.a.instance.RandomInt(0,1);if(0==e)this.AddToList(Array.from(w.entries()).find(e=>"rectangle"===e[0]));else if(1==e){let e=S[a.a.instance.RandomInt(0,S.length-1)];this.AddToList(Array.from(w.entries()).find(e=>"flag"===e[0]),[e.name,e.url],e.aspectRatio)}this.DefinitionTask()}}SaveUpdateValueList(e){this.UpdateValueList(e),this.SaveWindows()}}return e._instance=void 0,e})();(()=>{class e{constructor(e,t,i,s,a,r,n,h,o,l,d,m,u,w,g,S,p,v,_,b,f,P,C,E,x,R,y,I,M,z,N,W,T,k,L,A,D,F,H,B){this._isMotion=!1,this._launchStop="Стоп",this._launchStart="Старт",this._aspectRatio=1.5,this._parms=c.instance,this._isUseOffscreenCanvas=e,this._settings=t,this._redraw=s,this._overfill=a,this._manager=i,this._launch=r,this._mwsmContainer=h,this._mwsmArea=o,this._showParms=n,this._modalParms=l,this._modalParmsOK=d,this._modalParmsScaleAreaPanel=m,this._modalParmsFillTypePanel=u,this._modalParmsSelectedItemInfo=w,this._modalParmsShowSelectedItemWidthValue=g,this._modalParmsSelectedItemWidth=S,this._modalParmsSelectedItemWidthRange=p,this._modalParmsShowSelectedItemHeightValue=v,this._modalParmsSelectedItemHeight=_,this._modalParmsSelectedItemHeightRange=b,this._modalParmsShowSelectedItemLengthwaveValue=f,this._modalParmsSelectedItemLengthwave=P,this._modalParmsSelectedItemLengthwaveRange=C,this._modalParmsShowSelectedItemAmplitudewaveValue=E,this._modalParmsSelectedItemAmplitudewave=x,this._modalParmsSelectedItemAmplitudewaveRange=R,this._modalParmsShowSelectedItemPeriodwaveValue=y,this._modalParmsSelectedItemPeriodwave=I,this._modalParmsSelectedItemPeriodwaveRange=M,this._modalParmsShowSelectedItemShadingwaveValue=z,this._modalParmsSelectedItemShadingwave=N,this._modalParmsSelectedItemShadingwaveRange=W,this._modalParmsIsOffscreenCanvas=T,this._modalParmsIsTrackProportionsAreaMotion=k,this._modalParmsIsTranslucentModal=L,this._modalParmsSetDefault=A,this._mwsmStart=D,this._menuStart=F,this._mwsmTaskBar=H,this._menuSelect=B,this._aspectRatio=this._mwsmContainer.clientWidth/this._mwsmContainer.clientHeight,this.DependencyResolutions(),this.SetEvents()}static get instance(){if(!e._instance)throw new Error("Instance of Simulation was not created.");return e._instance}static Create(t,i,s,a,r,n,h,o,l,d,m,c,u,w,g,S,p,v,_,b,f,P,C,E,x,R,y,I,M,z,N,W,T,k,L,A,D,F,H,B){return e._instance||(e._instance=new e(t,i,s,a,r,n,h,o,l,d,m,c,u,w,g,S,p,v,_,b,f,P,C,E,x,R,y,I,M,z,N,W,T,k,L,A,D,F,H,B)),e.instance}DependencyResolutions(){this._viewParams=E.Create(this._parms,this._showParms,this._modalParms,this._modalParmsOK,this._modalParmsScaleAreaPanel,this._modalParmsFillTypePanel,this._modalParmsSelectedItemInfo,this._modalParmsShowSelectedItemWidthValue,this._modalParmsSelectedItemWidth,this._modalParmsSelectedItemWidthRange,this._modalParmsShowSelectedItemHeightValue,this._modalParmsSelectedItemHeight,this._modalParmsSelectedItemHeightRange,this._modalParmsShowSelectedItemLengthwaveValue,this._modalParmsSelectedItemLengthwave,this._modalParmsSelectedItemLengthwaveRange,this._modalParmsShowSelectedItemAmplitudewaveValue,this._modalParmsSelectedItemAmplitudewave,this._modalParmsSelectedItemAmplitudewaveRange,this._modalParmsShowSelectedItemPeriodwaveValue,this._modalParmsSelectedItemPeriodwave,this._modalParmsSelectedItemPeriodwaveRange,this._modalParmsShowSelectedItemShadingwaveValue,this._modalParmsSelectedItemShadingwave,this._modalParmsSelectedItemShadingwaveRange,this._modalParmsIsOffscreenCanvas,this._modalParmsIsTrackProportionsAreaMotion,this._modalParmsIsTranslucentModal,this._modalParmsSetDefault,this._menuSelect),this._viewMWS=W.Create(this._mwsmArea,this._mwsmStart,this._menuStart,this._mwsmTaskBar)}SetEvents(){window.addEventListener("resize",()=>{this.OnWindowResize()},!1),document.body.addEventListener("keydown",e=>{this.ListeningToKeystrokes(e)},!1),this._menuSelect.addEventListener("mouseleave",()=>{Object(s.a)(this._menuSelect)&&this.DisableMenuSelect()},!1),this._menuStart.addEventListener("mouseleave",()=>{Object(s.a)(this._menuStart)&&this.DisableMenuStart()},!1),this._settings.addEventListener("click",()=>{this.DefineSettings()},!1),this._redraw.addEventListener("click",()=>{this._viewMWS.Redraw()},!1),this._launch.addEventListener("click",()=>{this.SwitchStatusLaunch()},!1),this._overfill.addEventListener("click",()=>{document.dispatchEvent(new CustomEvent("CustomEventOverFill",{bubbles:!0}))},!1),document.addEventListener("CustomEventPermissionsIsSelected",e=>{this.PermissionsIsSelected(e)},!1)}OnWindowResize(){this._parms.isTrackProportionsAreaMotion&&(this._mwsmContainer.style.height=Math.floor(this._mwsmContainer.clientWidth/this._aspectRatio)+"px")}ListeningToKeystrokes(e){if(0===e.charCode)switch(e.keyCode){case 27:for(let e of document.getElementsByClassName("w3-modal"))Object(s.a)(e)&&(e.style.display="none");Object(s.a)(this._menuSelect)&&this.DisableMenuSelect(),Object(s.a)(this._menuStart)&&this.DisableMenuStart()}}DefineSettings(){this._viewParams.Open()}SwitchStatusLaunch(){this._isMotion=!this._isMotion,this.SetStateLaunch(this._isMotion),document.dispatchEvent(new CustomEvent("mwsm-change-status-wave-motion",{bubbles:!0,detail:{value:this._isMotion}}))}DisableMenuSelect(){this._menuSelect.dataset.type="empty",this._menuSelect.style.display="none"}DisableMenuStart(){this._menuStart.dataset.type="empty",this._menuStart.dataset.display="false"}PermissionsIsSelected(e){this.SetStateLaunch(e.detail.isAnimate),this._isMotion=e.detail.isAnimate}SetStateLaunch(e){e?(this._launch.innerHTML=`<span>${this._launchStop}</span>`,this._launch.dataset.simulation="isMotion"):(this._launch.innerHTML=`<span>${this._launchStart}</span>`,this._launch.dataset.simulation="isStop")}}return e._instance=void 0,e})().Create(document.getElementById("is-use-off-screen-canvas"),document.getElementById("settings"),document.getElementById("window-manager"),document.getElementById("redraw"),document.getElementById("overfill"),document.getElementById("launch"),document.getElementById("parms-show"),document.getElementById("mwsm-container"),document.getElementById("mwsm-area"),document.getElementById("parms-modal"),document.getElementById("parmsOK"),document.getElementById("parms-scale-area-panel"),document.getElementById("parms-fill-type-panel"),document.getElementById("selected-item-info"),document.getElementById("show-selected-item-width-value"),document.getElementById("parms-selected-item-width"),document.getElementById("show-selected-item-width-range"),document.getElementById("show-selected-item-height-value"),document.getElementById("parms-selected-item-height"),document.getElementById("show-selected-item-height-range"),document.getElementById("show-selected-item-lengthwave-value"),document.getElementById("parms-selected-item-lengthwave"),document.getElementById("show-selected-item-lengthwave-range"),document.getElementById("show-selected-item-amplitudewave-value"),document.getElementById("parms-selected-item-amplitudewave"),document.getElementById("show-selected-item-amplitudewave-range"),document.getElementById("show-selected-item-periodwave-value"),document.getElementById("parms-selected-item-periodwave"),document.getElementById("show-selected-item-periodwave-range"),document.getElementById("show-selected-item-shading-value"),document.getElementById("parms-selected-item-shading"),document.getElementById("show-selected-item-shadingwave-range"),document.getElementById("is-off-screen-canvas"),document.getElementById("is-track-proportions-area-motion"),document.getElementById("is-translucent-modal"),document.getElementById("set-default-parms"),document.getElementById("mwsm-start"),document.getElementById("menu-start"),document.getElementById("mwsm-task-bar"),document.getElementById("menu-select"))}]);