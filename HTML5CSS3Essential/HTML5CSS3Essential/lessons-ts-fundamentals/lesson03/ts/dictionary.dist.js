!function(e){var t={};function i(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(n,s,function(t){return e[t]}.bind(null,s));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";var n,s;i.r(t),String.prototype.padStart||(String.prototype.padStart=function(e,t){return e>>=0,t=String(t||" "),this.length>e?String(this):((e-=this.length)>t.length&&(t+=t.repeat(e/t.length)),t.slice(0,e)+String(this))}),function(e){e[e.Add=0]="Add",e[e.Edit=1]="Edit",e[e.Reproduce=2]="Reproduce",e[e.Info=3]="Info",e[e.Remove=4]="Remove",e[e.Find=5]="Find",e[e.ClearFind=6]="ClearFind",e[e.SelectLocalFiles=7]="SelectLocalFiles",e[e.IsSelected=8]="IsSelected",e[e.ToState=9]="ToState"}(n||(n={})),function(e){e[e.Disable=0]="Disable",e[e.Enable=1]="Enable"}(s||(s={}));let a=e=>`${e.toLocaleDateString()} ${e.toLocaleTimeString()}.${e.getMilliseconds()}`,d=e=>`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")}`,o=e=>"block"===e.style.display||"block"===window.getComputedStyle(e,null).display||"flex"===e.style.display||"flex"===window.getComputedStyle(e,null).display;class r{constructor(e,t,i,n,s){this._modal=e,this._header=t,this._content=i,this._yes=n,this._no=s}static get instance(){return this._instance}static Create(e,t,i,n,s){r._instance||(this._instance=new r(e,t,i,n,s))}get nameEventDeleteConfirm(){return"modalConfirm-delete-confirm"}get nameEventDeleteRefuse(){return"modalConfirm-delete-refuse"}get nameEventSureConfirm(){return"modalConfirm-sure-confirm"}get nameEventSureRefuse(){return"modalConfirm-sure-refuse"}get nameEventCaution(){return"modalConfirm-caution"}get eventDeleteConfirm(){return new CustomEvent(this.nameEventDeleteConfirm,{bubbles:!0})}get eventDeleteRefuse(){return new CustomEvent(this.nameEventDeleteRefuse,{bubbles:!0})}get eventCaution(){return new CustomEvent(this.nameEventCaution,{bubbles:!0})}OpenConfirmDelete(e,t=null){this._header.innerText="Подтвердите удаление",this._content.innerText=e,this.SetButtonDefault(),t?(this._yes.onclick=()=>{document.dispatchEvent(new CustomEvent(this.nameEventDeleteConfirm,{bubbles:!0,detail:{resolve:t("yes")}}))},this._no.onclick=()=>{document.dispatchEvent(new CustomEvent(this.nameEventDeleteRefuse,{bubbles:!0,detail:{resolve:t("no")}}))}):(this._yes.onclick=()=>{document.dispatchEvent(this.eventDeleteConfirm)},this._no.onclick=()=>{document.dispatchEvent(this.eventDeleteRefuse)}),this._modal.style.display="block"}OpenSure(e){this._header.innerText="Are you sure?",this._content.innerText="Please confirm the action",this.SetButtonDefault(),this._yes.onclick=()=>{document.dispatchEvent(new CustomEvent(this.nameEventSureConfirm,{bubbles:!0,detail:{resolve:e("yes")}}))},this._no.onclick=()=>{document.dispatchEvent(new CustomEvent(this.nameEventSureRefuse,{bubbles:!0,detail:{resolve:e("no")}}))},this._modal.style.display="block"}OpenCaution(e){this._header.innerText="!!! Внимание",this._content.innerText=e,this.SetButtonCaution(),this._yes.onclick=()=>{document.dispatchEvent(this.eventCaution)},this._modal.style.display="block"}SetButtonDefault(){this.ToVisibilityBtn(this._yes),this.ToVisibilityBtn(this._no),this._yes.innerText="Confirm",this._no.innerText="Refuse"}SetButtonCaution(){this.ToVisibilityBtn(this._yes),this.ToUnVisibilityBtn(this._no),this._yes.innerText="OK"}ToVisibilityBtn(e){e.style.position="static",e.style.visibility="visible"}ToUnVisibilityBtn(e){e.style.position="absolute ",e.style.visibility="hidden"}}r._instance=void 0;class l{constructor(e,t){this._eventChangeMarkRow=new CustomEvent("changeMarkRow",{bubbles:!0,detail:{content:this}}),this._checkBox=e,this._img=t,this._img.src=l.imgCheckBlankOutlineBlack,this._checkBox.addEventListener("change",()=>{this.OnChange()},!1)}get valueRow(){return this._valueRow}set valueRow(e){this._valueRow=e}get row(){return this._row}set row(e){this._row=e}get checked(){return this._checkBox.checked}set checked(e){this._checkBox.checked=e}get isDisable(){return this._checkBox.disabled}set isDisable(e){this._checkBox.disabled=e}OnChange(){this._checkBox.checked?this._img.src=l.imgCheckBoxOutline:this._img.src=l.imgCheckBlankOutlineBlack,document.dispatchEvent(this._eventChangeMarkRow)}}class h extends l{constructor(e,t){super(e,t),this.isDisable=!0,this._eventChangeMarkRow=new CustomEvent("changeMarkAllRows",{bubbles:!0,detail:{content:this}})}}class c{constructor(e){this._panel=e,this.SetEvents()}get isOn(){return o(this._panel)}On(e){let t=this.GetMouseCoordinates(e);this.isOn?(this.Off(),this.On(e)):(this._panel.style.left=t.x+"px",this._panel.style.top=t.y+"px",this._panel.style.display="block",setTimeout(()=>{this._panel.style.opacity="1"},50))}Off(){this.isOn&&(this._panel.style.opacity="0",setTimeout(()=>{this._panel.style.display="none"},290))}SetEvents(){this._panel.addEventListener("contextmenu",e=>{e.preventDefault(),this.Off()},!1),this._panel.addEventListener("mouseleave",()=>{this.Off()},!1),this._panel.addEventListener("click",()=>{this.Off()},!1),window.addEventListener("resize",()=>{this.Off()},!1),window.addEventListener("scroll",()=>{this.Off()},!1)}GetMouseCoordinates(e){let t=0,i=0;return e.pageX||e.pageY?(t=e.pageX-10,i=e.pageY-document.documentElement.scrollTop-21):(e.clientX||e.clientY)&&(t=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:t,y:i}}}class m{constructor(e,t,i,n,s){this._name=e,this._typeAction=t,this._state=i,this._action=n,this._context=s}get name(){return this._name}get typeAction(){return this._typeAction}get state(){return this._state}set state(e){this._state=e,document.dispatchEvent(this.eventChangeState)}get isEnabled(){return this.state==s.Enable}get eventChangeState(){return new CustomEvent(m.eventNameChangeState,{bubbles:!0,detail:{command:this}})}Execute(){this.isEnabled&&this._action.call(this._context)}}m.eventNameChangeState="command-change-state";class u{constructor(e,t){this._element=e,this._command=t,this.Installation()}get element(){return this._element}get command(){return this._command}get isEnabled(){return!!this.element.dataset.enabled&&this.element.dataset.enabled==(!0).toString()}set isEnabled(e){this.element.dataset.enabled=e.toString()}Installation(){this.isEnabled=this.command.isEnabled,this.element.addEventListener("click",()=>{this.command.Execute()},!1),document.addEventListener(m.eventNameChangeState,e=>{this.OnCommandChangeState(e)},!1)}OnCommandChangeState(e){if(e.detail.command){let t=e.detail.command;this.command.name==t.name&&(this.isEnabled=t.isEnabled)}}}var _,p,y,g,v;!function(e){e[e.Key=0]="Key",e[e.Code=1]="Code",e[e.Value=2]="Value",e[e.Create=3]="Create",e[e.Update=4]="Update"}(_||(_={})),function(e){e[e.No=0]="No",e[e.Ascending=1]="Ascending",e[e.Descending=2]="Descending"}(p||(p={}));class f extends class{constructor(){this._isSorted=!1,this._isReverseSorted=!1,this._sequence=0,this._data=[]}get isSorted(){return this._isSorted}set isSorted(e){this._isSorted=e}get isReverseSorted(){return this._isReverseSorted}set isReverseSorted(e){this._isReverseSorted=e}get data(){return this._data}set data(e){this._data=e}get length(){return this.data.length}get list(){return this.Sorted(),this.GetValues()}get reverseList(){return this.ReverseSorted(),this.GetValues()}get firstItem(){return 0!=this.data.length?this.data[0]:void 0}get lastItem(){return 0!=this.data.length?this.data[this.data.length-1]:void 0}find(e){return this.data.find(t=>t.primaryKey==e)}isIt(e){return this.data.some(t=>t.primaryKey==e)}add(e){return e.primaryKey=++this._sequence,!!this.data.every(t=>!t.Equals(e))&&(this.data.push(e),this._isSorted=!1,this._isReverseSorted=!1,!0)}loadItem(e){return!!this.data.every(t=>!t.Equals(e))&&(this._sequence=e.primaryKey>this._sequence?e.primaryKey:this._sequence,this.data.push(e),this._isSorted=!1,this._isReverseSorted=!1,!0)}remove(e){this.data.splice(this.data.indexOf(e),1)}clear(){this.data.length=0}toString(){return this.ReverseSorted(),this.data.reduce((e,t)=>`${e}\n${t.toString()}`,"")}Sorted(){this.isSorted||(this.data=this.data.sort((e,t)=>e.primaryKey-t.primaryKey),this.isSorted=!0,this.isReverseSorted=!1)}ReverseSorted(){this.isReverseSorted||(this.data=this.data.sort((e,t)=>t.primaryKey-e.primaryKey),this.isSorted=!1,this.isReverseSorted=!0)}*GetValues(){for(let e=0;e<this.data.length;e++)yield this.data[e]}}{constructor(){super(...arguments),this._sortKind=_.Key,this._sortState=p.No}get sortKind(){return this._sortKind}set sortKind(e){this._sortKind=e}get IsMustBeSorted(){return this._sortKind!=_.Key}get sorted(){return this._sortState==p.Ascending||this._sortState==p.No?this.list:this.reverseList}updateItem(e){if(this.data.some(t=>t.primaryKey==e.primaryKey)){let t=this.data.find(t=>t.primaryKey==e.primaryKey);return t.code=e.code,t.value=e.value,t.description=e.description,t.dateUpdate=e.dateUpdate,!0}return!1}Includes(e){return this.data.some(t=>t.Equals(e))}Sorted(){if(!this.isSorted){switch(this.sortKind){case _.Key:this.data=this.data.sort((e,t)=>e.primaryKey-t.primaryKey);break;case _.Code:this.data=this.data.sort((e,t)=>e.code.localeCompare(t.code));break;case _.Value:this.data=this.data.sort((e,t)=>e.value.localeCompare(t.value));break;case _.Create:this.data=this.data.sort((e,t)=>e.dateCreate<t.dateCreate?-1:e.dateCreate>t.dateCreate?1:0);break;case _.Update:this.data=this.data.sort((e,t)=>e.dateUpdate<t.dateUpdate?-1:e.dateUpdate>t.dateUpdate?1:0)}this.isSorted=!0,this.isReverseSorted=!1}}ReverseSorted(){if(!this.isReverseSorted){switch(this.sortKind){case _.Key:this.data=this.data.sort((e,t)=>t.primaryKey-e.primaryKey);break;case _.Code:this.data=this.data.sort((e,t)=>t.code.localeCompare(e.code));break;case _.Value:this.data=this.data.sort((e,t)=>t.value.localeCompare(e.value));break;case _.Create:this.data=this.data.sort((e,t)=>t.dateCreate<e.dateCreate?-1:t.dateCreate>e.dateCreate?1:0);break;case _.Update:this.data=this.data.sort((e,t)=>t.dateUpdate<e.dateUpdate?-1:t.dateUpdate>e.dateUpdate?1:0)}this.isSorted=!1,this.isReverseSorted=!0}}NextSortStep(e){switch(this._sortKind!=_.Key&&e!=this._sortKind&&this.ClearSort(),this._sortKind=e,this._sortState){case p.No:this._sortState=p.Ascending,document.getElementById("img-ascending-"+e).style.display="inline",document.getElementById("img-descending-"+e).style.display="none";break;case p.Ascending:this._sortState=p.Descending,document.getElementById("img-ascending-"+e).style.display="none",document.getElementById("img-descending-"+e).style.display="inline";break;case p.Descending:this.ClearSort()}}ClearSort(){this._sortState=p.No,document.getElementById("img-ascending-"+this._sortKind).style.display="none",document.getElementById("img-descending-"+this._sortKind).style.display="none",this._sortKind=_.Key}}class C{constructor(e,t,i,n="",s=new Date(Date.now()),a=s){this._primaryKey=e,this._code=t,this._value=i,this._description=n,this._dateCreate=s,this._dateUpdate=a}get primaryKey(){return this._primaryKey}set primaryKey(e){this._primaryKey=e}get code(){return this._code}set code(e){this.dateUpdate=new Date(Date.now()),this._code=e}get value(){return this._value}set value(e){this.dateUpdate=new Date(Date.now()),this._value=e}get description(){return this._description}set description(e){this.dateUpdate=new Date(Date.now()),this._description=e}get dateCreate(){return this._dateCreate}set dateCreate(e){this._dateCreate=e}get dateUpdate(){return this._dateUpdate}set dateUpdate(e){this._dateUpdate=e}Equals(e){return e.primaryKey==this.primaryKey||e.code===this.code||e.value===this.value}toString(){return` ${this.primaryKey.toString().padStart(C.maxLengthPriamryKeyToString)} | ${this.code.padEnd(C.maxLengthCode)} | ${this.value.padEnd(C.maxLengthValueToString)} | ${a(this.dateUpdate)} | ${a(this.dateCreate)} | `+this.description}}C.maxLengthCode=20,C.maxLengthValue=160,C.maxLengthDescription=4e3,C.maxLengthPriamryKeyToString=2,C.maxLengthValueToString=10;class E{}class w{constructor(e,t,i,n,s,a,d,o,r,l){this._current=new E,this._modal=e,this._isCreationDate=t,this._isDateOfChange=i,this._noDate=n,this._periodFrom=s,this._periodTo=a,this._code=d,this._value=o,this._yes=r,this._no=l}static get instance(){return this._instance}static Create(e,t,i,n,s,a,d,o,r,l){w._instance||(this._instance=new w(e,t,i,n,s,a,d,o,r,l))}get current(){return this._current}set current(e){this._current=e}get nameEventApply(){return"modalDicDefinitionFind-Apply"}get nameEventRefuse(){return"modalDicDefinitionFind-Refuse"}get eventApply(){return new CustomEvent(this.nameEventApply,{bubbles:!0})}get eventRefuse(){return new CustomEvent(this.nameEventRefuse,{bubbles:!0})}SetCurrent(){this.current.isCreationDate=this._isCreationDate.checked,this.current.isDateOfChange=this._isDateOfChange.checked,this.current.noDate=this._noDate.checked,this.current.periodFrom=new Date(this._periodFrom.value),this.current.periodTo=new Date(this._periodTo.value),this.current.code=this._code.value,this.current.value=this._value.value}OpenFinder(){this._yes.onclick=()=>{this.SetCurrent(),document.dispatchEvent(this.eventApply)},this._no.onclick=()=>{document.dispatchEvent(this.eventRefuse)},this._modal.style.display="block"}isFind(){let e=!1;return(this._isCreationDate.checked||this._isDateOfChange.checked||this._code.value.length>0||this._value.value.length>0)&&(e=!0),e}isSatisfy(e){return(!this.current.isCreationDate||this.current.isCreationDate&&this.current.periodFrom<=e.dateCreate&&e.dateCreate<=this.current.periodTo)&&(!this.current.isDateOfChange||this.current.isDateOfChange&&this.current.periodFrom<=e.dateUpdate&&e.dateUpdate<=this.current.periodTo)&&(0==this.current.code.length||this.current.code.length>0&&e.code.includes(this.current.code))&&(0==this.current.value.length||this.current.value.length>0&&e.value.includes(this.current.value))}Clear(){this._noDate.checked=!0,this._code.value="",this._value.value="",this.SetCurrent()}Show(e){e.innerHTML="";let t=document.createElement("span");if(this._isCreationDate.checked?t.innerHTML="Дата создания: ":this._isDateOfChange.checked&&(t.innerHTML="Дата изменения: "),!this._noDate.checked){let e=new Date(this._periodFrom.value),i=new Date(this._periodTo.value);t.innerHTML+=`с <b>${e.toLocaleDateString()}</b> по <b>${i.toLocaleDateString()}</b>;  `}this._code.value.length>0&&(t.innerHTML+=`ключ: <b>${this._code.value}</b>;  `),this._value.value.length>0&&(t.innerHTML+=`значение: <b>${this._value.value}</b>;  `),e.appendChild(t)}}!function(e){e[e.Add=0]="Add",e[e.Edit=1]="Edit",e[e.Reduce=2]="Reduce",e[e.Info=3]="Info"}(y||(y={}));class b{constructor(e,t,i,n,s,a,d,o,r,l,h,c,m){this._modal=e,this._header=t,this._imgHeader=i,this._code=n,this._codeCounter=s,this._value=a,this._valueCounter=d,this._description=o,this._descriptionCounter=r,this._dateCreate=l,this._dateUpdate=h,this._yes=c,this._no=m,this.SetEvents(),this.ShowGets()}static get instance(){return this._instance}static Create(e,t,i,n,s,a,d,o,r,l,h,c,m){b._instance||(this._instance=new b(e,t,i,n,s,a,d,o,r,l,h,c,m))}get nameEventAddApply(){return"modalDicDefinitionAdd-Apply"}get nameEventAddRefuse(){return"modalDicDefinitionAdd-Refuse"}get nameEventEditApply(){return"modalDicDefinitionEdit-Apply"}get nameEventEditRefuse(){return"modalDicDefinitionEdit-Refuse"}get nameEventInfoOk(){return"modalDicDefinitionInfo-OK"}get eventAddApply(){return new CustomEvent(this.nameEventAddApply,{bubbles:!0})}get eventAddRefuse(){return new CustomEvent(this.nameEventAddRefuse,{bubbles:!0})}get eventEditApply(){return new CustomEvent(this.nameEventEditApply,{bubbles:!0})}get eventEditRefuse(){return new CustomEvent(this.nameEventEditRefuse,{bubbles:!0})}get eventInfoOk(){return new CustomEvent(this.nameEventInfoOk,{bubbles:!0})}get isCodeString(){return isNaN(+this._code.value)}get isValueString(){return isNaN(+this._value.value)}set toCodeVerify(e){this._code.dataset.verify=e.toString()}set toValueVerify(e){this._value.dataset.verify=e.toString()}OpenAdd(){this._mode=y.Add,this._header.innerText="Добавить",this._imgHeader.src=b.imgAdd,this._yes.onclick=()=>{document.dispatchEvent(this.eventAddApply)},this._no.onclick=()=>{document.dispatchEvent(this.eventAddRefuse)},this.SetButtonDefault(),this._old=new C(0,"","",""),this._new=new C(1,"","",""),this.Init(),this.ShowGets(),this._modal.style.display="block"}OpenReproduce(e){this._mode=y.Reduce,this._header.innerText="Размножить",this._imgHeader.src=b.imgReproduce,this._yes.onclick=()=>{document.dispatchEvent(this.eventAddApply)},this._no.onclick=()=>{document.dispatchEvent(this.eventAddRefuse)},this.SetButtonDefault(),this._old=e,this._new=new C(e.primaryKey,e.code,e.value,e.description,e.dateCreate,e.dateUpdate),this.Init(),this.ShowGets(),this._modal.style.display="block"}OpenEdit(e){this._mode=y.Edit,this._header.innerText="Исправить",this._imgHeader.src=b.imgEdit,this._yes.onclick=()=>{document.dispatchEvent(this.eventEditApply)},this._no.onclick=()=>{document.dispatchEvent(this.eventEditRefuse)},this.SetButtonDefault(),this._old=e,this._new=new C(e.primaryKey,e.code,e.value,e.description,e.dateCreate,e.dateUpdate),this.Init(),this.ShowGets(),this._modal.style.display="block"}OpenInfo(e){this._mode=y.Info,this._header.innerText="Информация",this._imgHeader.src=b.imgInfo,this._yes.onclick=()=>{document.dispatchEvent(this.eventInfoOk)},this._no.onclick=()=>{document.dispatchEvent(this.eventEditRefuse)},this.SetButtonInfo(),this._old=e,this._new=new C(e.primaryKey,e.code,e.value,e.description,e.dateCreate,e.dateUpdate),this.Init(),this._modal.style.display="block"}SetEvents(){this._code.addEventListener("input",()=>{this.OnInputCode()},!1),this._value.addEventListener("input",()=>{this.OnInputValue()},!1),this._description.addEventListener("input",()=>{this.OnInputDescription()},!1),document.addEventListener(this.nameEventInfoOk,()=>{this._modal.style.display="none"})}ShowGets(){this.isCodeString&&this.isValueString&&(this._code.value!==this._old.code&&this._value.value!==this._old.value&&(this._mode==y.Add||this._mode==y.Reduce)||this._mode==y.Edit&&(this._code.value!==this._old.code||this._value.value!==this._old.value||this._description.value!==this._old.description))||this._mode==y.Info?this._yes.disabled=!1:this._yes.disabled=!0}Init(){this._code.value=this._old.code,this._value.value=this._old.value,this._description.value=this._old.description,this._mode==y.Add?(this._dateCreate.textContent="",this._dateUpdate.textContent=""):(this._dateCreate.textContent=a(this._old.dateCreate),this._dateUpdate.textContent=a(this._old.dateUpdate)),this.OnInputCode(),this.OnInputValue(),this.OnInputDescription(),this._mode==y.Info?(this._code.readOnly=!0,this._value.readOnly=!0,this._description.readOnly=!0):(this._code.readOnly=!1,this._value.readOnly=!1,this._description.readOnly=!1)}SetButtonDefault(){this.ToVisibilityBtn(this._yes),this.ToVisibilityBtn(this._no),this._yes.innerText="Apply",this._no.innerText="Refuse"}SetButtonInfo(){this.ToVisibilityBtn(this._yes),this.ToUnVisibilityBtn(this._no),this._yes.innerText="OK"}ToVisibilityBtn(e){e.style.position="static",e.style.visibility="visible"}ToUnVisibilityBtn(e){e.style.position="absolute ",e.style.visibility="hidden"}SetCounterCode(e=!1){this._codeCounter.innerText=`${e?0:this._code.value.length} /${C.maxLengthCode}`}SetCounterValue(e=!1){this._valueCounter.innerText=`${e?0:this._value.value.length} /${C.maxLengthValue}`}SetCounterDescription(){this._descriptionCounter.innerText=`${this._description.value.length} /${C.maxLengthDescription}`}OnInputCode(){this.isCodeString?(this.toCodeVerify=!0,this.SetCounterCode()):(this.toCodeVerify=!1,this.SetCounterCode(!0)),this.ShowGets()}OnInputValue(){this.isValueString?(this.toValueVerify=!0,this.SetCounterValue()):(this.toValueVerify=!1,this.SetCounterValue(!0)),this.ShowGets()}OnInputDescription(){this.SetCounterDescription(),this.ShowGets()}}class S{constructor(e,t=!1,i=""){this.id=e,this.isSuccess=t,this.error=i}}class D{constructor(e,t,i,n,s=new Date(Date.now()),a=s){this.primaryKey=e,this.code=t,this.value=i,this.description=n,this.dateCreate=s,this.dateUpdate=a}}class R{constructor(e){this._name=e}static get instance(){return this._instance}static Create(e="FirstWebDB"){R._instance||(this._instance=new R(e))}get db(){if(this._db)return this._db;throw this._name+": IndexedDB was not open!"}Open(e){if(!window.indexedDB)throw"This browser does not support IndexedDB";this._openRequest=indexedDB.open(this._name,1),this._openRequest.onupgradeneeded=e=>{this.OnOpenUpgradeNeeded(e)},this._openRequest.onsuccess=t=>{this.OnOpenSuccess(t,e)},this._openRequest.onerror=e=>{this.OnOpenError(e)}}AddDicDefinition(e,t,i){let n=this.db.transaction(R.objDefinitions,"readwrite").objectStore(R.objDefinitions).add({code:e.code,value:e.value,description:e.description,dateCreate:e.dateCreate,dateUpdate:e.dateUpdate});n.onsuccess=()=>{t(!0)},n.onerror=()=>{i(`Error ${n.error.code}-${n.error.name}\n${n.error.message}`)}}UpdateDicDefinition(e,t,i){let n=this.db.transaction(R.objDefinitions,"readwrite").objectStore(R.objDefinitions).put({primaryKey:e.primaryKey,code:e.code,value:e.value,description:e.description,dateCreate:e.dateCreate,dateUpdate:e.dateUpdate});n.onsuccess=()=>{t(!0)},n.onerror=()=>{i(`Error ${n.error.code}-${n.error.name}\n${n.error.message}`)}}LoadDicDefinition(e,t){let i=this.db.transaction(R.objDefinitions).objectStore(R.objDefinitions).openCursor();i.onsuccess=i=>{this.OnLoad(i,e,t)},i.onerror=()=>{throw`Error ${i.error.code}-${i.error.name}\n${i.error.message}`}}RemoveDicDefinition(e,t,i){let n=this.db.transaction(R.objDefinitions,"readwrite").objectStore(R.objDefinitions),s=0;for(let a of e){let d=n.delete(a.id);d.onsuccess=()=>{a.isSuccess=!0,s++,s==e.length&&t(!0)},d.onerror=()=>{a.isSuccess=!1,a.error=`Error ${d.error.code}-${d.error.name}\n${d.error.message}`,i(a.error)}}}OnOpenUpgradeNeeded(e){switch(this._db=e.target.result,this._db.version){case 1:this.DBInitOne()}}DBInitOne(){let e=this._db.createObjectStore("Definitions",{keyPath:"primaryKey",autoIncrement:!0});e.createIndex("code_idx","code",{unique:!0}),e.createIndex("value-idx","value",{unique:!0})}OnOpenSuccess(e,t){this._db=e.target.result,t(!0)}OnOpenError(e){throw`Error ${this._openRequest.error.code}-${this._openRequest.error.name}\n${this._openRequest.error.message}`}OnLoad(e,t,i){let n=event.target.result;n?(t.push(new D(n.value.primaryKey,n.value.code,n.value.value,n.value.description,n.value.dateCreate,n.value.dateUpdate)),n.continue()):i(!0)}}R.objDefinitions="Definitions",R._instance=void 0,function(e){e[e.FindIsCreationDate=0]="FindIsCreationDate",e[e.FindIsDateOfChange=1]="FindIsDateOfChange",e[e.FindNoDate=2]="FindNoDate",e[e.FindPeriodFrom=3]="FindPeriodFrom",e[e.FindPeriodTo=4]="FindPeriodTo",e[e.FindCode=5]="FindCode",e[e.FindValue=6]="FindValue"}(g||(g={}));class O{constructor(e){this.type="DicDefinition",this.parameter=e}}class I{constructor(e,t,i){this.isValue=e,this.dt=t,this.value=i}}!function(e){e[e.All=0]="All",e[e.AddedRecord=1]="AddedRecord",e[e.UpdatedRecord=2]="UpdatedRecord"}(v||(v={}));new class{constructor(e,t,i,n,s,a,d,o,r,c,m,u,_,p,y,g,v,C,E,w,b,S,D,R,O,I,k,F,B,A,x,K,T,L,V,U,N,P,$,M,H,j,G,q,J,Y,W,z,X){this._collection=new f,this._markRows=[],this._controls=[],this._btnAdd=e,this._btnReproduce=t,this._btnEdit=i,this._btnInfo=n,this._btnDel=s,this._btnFind=a,this._btnClearFind=d,this._tHeader=o,this._rowHeader=r,this._tBody=c,this._modalConfirm=_,this._modalConfirmYes=p,this._modalConfirmNo=y,this._confirmHeader=g,this._confirmAbout=v,this._showFindParams=C,this._modalFind=E,this._modalFindIsCreationDate=w,this._modalFindIsDateOfChange=b,this._modalFindnoDate=S,this._modalFindPeriodFrom=D,this._modalFindPeriodTo=R,this._modalFindCode=O,this._modalFindValue=I,this._modalFindYes=k,this._modalFindNo=F,this._modalEdit=B,this._modalEditHeader=A,this._modalEditImgHeader=x,this._modalEditCode=K,this._modalEditCodeCounter=T,this._modalEditValue=L,this._modalEditValueCounter=V,this._modalEditDescription=U,this._modalEditDescriptionCounter=N,this._modalEditDateCreate=P,this._modalEditDateUpdate=$,this._modalEditYes=M,this._modalEditNo=H,this._dicContextMenu=j,this._cmItemAdd=G,this._cmItemReproduce=q,this._cmItemEdit=J,this._cmItemInfo=Y,this._cmItemDel=W,this._cmItemFind=z,this._cmItemClearFind=X,l.imgCheckBlankOutlineBlack="../../img/checkbox-blank-outline-black.png",l.imgCheckBoxOutline="../../img/check-box-outline.png",this._markAllRows=new h(m,u),this.SetEvents(),this.AlignWidthTables(),this.ShowGets()}get countSelected(){return this._markRows.reduce((e,t)=>e+(t.checked?1:0),0)}get isSelected(){return this.countSelected>0}ShowGets(){this._collection.length>0?this._markAllRows.isDisable=!1:this._markAllRows.isDisable=!0,this.isSelected?this._cmdRemove.state=s.Enable:this._cmdRemove.state=s.Disable,this._selected?(this._cmdEdit.state=s.Enable,this._cmdReproduce.state=s.Enable,this._cmdInfo.state=s.Enable):(this._cmdEdit.state=s.Disable,this._cmdReproduce.state=s.Disable,this._cmdInfo.state=s.Disable),w.instance.Show(this._showFindParams),w.instance.isFind()?this._cmdClearFind.state=s.Enable:this._cmdClearFind.state=s.Disable}AlignWidthTables(){this._tBody.offsetWidth==this._tBody.clientWidth&&(this._tHeader.style.width=this._tBody.offsetWidth+"px")}SetEvents(){r.Create(this._modalConfirm,this._confirmHeader,this._confirmAbout,this._modalConfirmYes,this._modalConfirmNo),w.Create(this._modalFind,this._modalFindIsCreationDate,this._modalFindIsDateOfChange,this._modalFindnoDate,this._modalFindPeriodFrom,this._modalFindPeriodTo,this._modalFindCode,this._modalFindValue,this._modalFindYes,this._modalFindNo),b.Create(this._modalEdit,this._modalEditHeader,this._modalEditImgHeader,this._modalEditCode,this._modalEditCodeCounter,this._modalEditValue,this._modalEditValueCounter,this._modalEditDescription,this._modalEditDescriptionCounter,this._modalEditDateCreate,this._modalEditDateUpdate,this._modalEditYes,this._modalEditNo),b.imgAdd="../../img/plus.png",b.imgReproduce="../../img/content-reproduce.png",b.imgEdit="../../img/edit-outline.png",b.imgInfo="../../img/information-outline-24.png",this.LoadParams(),this._cm=new c(this._dicContextMenu),this._cmdAdd=new m("add",n.Add,s.Enable,b.instance.OpenAdd,b.instance),this._cmdFind=new m("find",n.Find,s.Enable,w.instance.OpenFinder,w.instance),this._cmdClearFind=new m("clearFind",n.ClearFind,s.Disable,this.ClearFind,this),this._cmdRemove=new m("remove",n.Remove,s.Disable,this.Remove,this),this._cmdEdit=new m("edit",n.Edit,s.Disable,this.Edit,this),this._cmdReproduce=new m("reproduce",n.Reproduce,s.Disable,this.Reproduce,this),this._cmdInfo=new m("info",n.Info,s.Disable,this.Info,this),this._controls.push(new u(this._btnAdd,this._cmdAdd)),this._controls.push(new u(this._cmItemAdd,this._cmdAdd)),this._controls.push(new u(this._btnFind,this._cmdFind)),this._controls.push(new u(this._cmItemFind,this._cmdFind)),this._controls.push(new u(this._btnClearFind,this._cmdClearFind)),this._controls.push(new u(this._cmItemClearFind,this._cmdClearFind)),this._controls.push(new u(this._btnDel,this._cmdRemove)),this._controls.push(new u(this._cmItemDel,this._cmdRemove)),this._controls.push(new u(this._btnEdit,this._cmdEdit)),this._controls.push(new u(this._cmItemEdit,this._cmdEdit)),this._controls.push(new u(this._btnReproduce,this._cmdReproduce)),this._controls.push(new u(this._cmItemReproduce,this._cmdReproduce)),this._controls.push(new u(this._btnInfo,this._cmdInfo)),this._controls.push(new u(this._cmItemInfo,this._cmdInfo)),window.addEventListener("resize",()=>{this.AlignWidthTables()},!1),document.body.addEventListener("keydown",e=>{this.ListeningToKeystrokes(e)},!1),document.addEventListener(w.instance.nameEventApply,()=>{this.OnFindApply()},!1),document.addEventListener(w.instance.nameEventRefuse,()=>{this._modalFind.style.display="none"},!1),document.addEventListener(b.instance.nameEventAddApply,()=>{this.OnEditAddApply()},!1),document.addEventListener(b.instance.nameEventAddRefuse,()=>{this._modalEdit.style.display="none"},!1),document.addEventListener(b.instance.nameEventEditApply,()=>{this.OnEditEditApply()},!1),document.addEventListener(b.instance.nameEventEditRefuse,()=>{this._modalEdit.style.display="none"},!1),document.addEventListener(r.instance.nameEventSureConfirm,e=>{this.OnConfirm(e)},!1),document.addEventListener(r.instance.nameEventSureRefuse,e=>{this.OnRefuse(e)},!1),document.addEventListener(r.instance.nameEventDeleteConfirm,e=>{this.OnConfirm(e)},!1),document.addEventListener(r.instance.nameEventDeleteRefuse,e=>{this.OnRefuse(e)},!1),document.addEventListener(r.instance.nameEventCaution,()=>{this._modalConfirm.style.display="none"}),this._rowHeader.addEventListener("contextmenu",e=>{this.OnRowContextmenu(e)},!1),this._rowHeader.addEventListener("click",e=>{this.OnColumnSorted(e)},!1),document.addEventListener("changeMarkAllRows",e=>{this.OnChangeMarkAllRows()},!1),document.addEventListener("changeMarkRow",e=>{this.OnChangeMarkRow()},!1),R.Create();try{new Promise(e=>{R.instance.Open(e)}).then(e=>{e&&this.Load(v.All)})}catch(e){r.instance.OpenCaution(e)}}OnColumnSorted(e){let t=e.target;t.dataset.sort&&(this._collection.NextSortStep(Number(t.dataset.sort)),this.Load(v.All))}Remove(){new Promise(e=>{r.instance.OpenConfirmDelete(`Удалить ${this.countSelected} из ${this._markRows.length}`,e)}).then(e=>{if(e){let e=[];for(let t of this._markRows.filter(e=>e.checked))e.push(new S(t.valueRow.primaryKey));new Promise((t,i)=>{R.instance.RemoveDicDefinition(e,t,i)}).then(t=>{t&&this.RemoveShowResults(e)},t=>{this.RemoveShowResults(e),r.instance.OpenCaution(t)})}})}RemoveShowResults(e){for(let t of e){let e=this._markRows.find(e=>t.isSuccess&&e.valueRow.primaryKey==t.id);if(this._selected&&this._selected.dataset.primaryKey===e.row.dataset.primaryKey&&(this._selected=null),e){for(let t of this._tBody.children)t.dataset.primaryKey&&t.dataset.primaryKey==e.row.dataset.primaryKey&&this._tBody.removeChild(t);this._collection.remove(e.valueRow),this._markRows.splice(this._markRows.indexOf(e),1)}}this._markAllRows.checked&&(this._markAllRows.checked=!1),this.ShowGets()}Edit(){b.instance.OpenEdit(this._markRows.find(e=>e.valueRow.primaryKey.toString()===this._selected.dataset.primaryKey).valueRow)}Reproduce(){b.instance.OpenReproduce(this._markRows.find(e=>e.valueRow.primaryKey.toString()===this._selected.dataset.primaryKey).valueRow)}Info(){b.instance.OpenInfo(this._markRows.find(e=>e.valueRow.primaryKey.toString()===this._selected.dataset.primaryKey).valueRow)}ClearFind(){w.instance.Clear(),this.OnFindApply()}OnFindApply(){this.SaveFindParams(w.instance.current),this._modalFind.style.display="none",this.Load(v.All),this.ShowGets()}OnEditAddApply(){new Promise(e=>{r.instance.OpenSure(e)}).then(e=>{if(e){try{new Promise((e,t)=>{R.instance.AddDicDefinition(new D(0,this._modalEditCode.value,this._modalEditValue.value,this._modalEditDescription.value),e,t)}).then(e=>{try{this.Load(v.AddedRecord)}catch(e){r.instance.OpenCaution(e)}},e=>r.instance.OpenCaution(e))}catch(e){r.instance.OpenCaution(e)}this._modalEdit.style.display="none"}})}OnEditEditApply(){new Promise(e=>{r.instance.OpenSure(e)}).then(e=>{if(e){try{new Promise((e,t)=>{let i=this._markRows.find(e=>e.valueRow.primaryKey.toString()===this._selected.dataset.primaryKey).valueRow;R.instance.UpdateDicDefinition(new D(i.primaryKey,this._modalEditCode.value,this._modalEditValue.value,this._modalEditDescription.value,i.dateCreate,new Date(Date.now())),e,t)}).then(e=>{try{this.Load(v.UpdatedRecord,this._markRows.find(e=>e.valueRow.primaryKey.toString()===this._selected.dataset.primaryKey).valueRow.primaryKey)}catch(e){r.instance.OpenCaution(e)}},e=>r.instance.OpenCaution(e))}catch(e){r.instance.OpenCaution(e)}this._modalEdit.style.display="none"}})}Load(e,t=0){let i=[];new Promise(e=>{R.instance.LoadDicDefinition(i,e)}).then(n=>{if(n){switch(w.instance.isFind()&&(i=i.filter(e=>w.instance.isSatisfy(e))),e){case v.All:case v.AddedRecord:this._collection.clear(),this._tBody.innerHTML="",this.LoadedToShow(i);break;case v.UpdatedRecord:let e=i.find(e=>e.primaryKey==t);this._collection.updateItem(new C(e.primaryKey,e.code,e.value,e.description,e.dateCreate,e.dateUpdate))?this.UpdatedToShowBody(this._collection.find(t)):r.instance.OpenCaution("Нарушение целостности данных. Обновите страницу.")}this.ShowGets()}})}OnConfirm(e){e.detail.resolve&&e.detail.resolve(!0),this._modalConfirm.style.display="none"}OnRefuse(e){e.detail.resolve&&e.detail.resolve(!1),this._modalConfirm.style.display="none"}ListeningToKeystrokes(e){if(0===e.charCode)switch(e.keyCode){case 27:for(let e of document.getElementsByClassName("w3-modal"))o(e)&&(e.style.display="none");this._cm.Off()}}OnRowContextmenu(e){e.preventDefault(),this._cm.On(e)}LoadedToShow(e){for(let t of e)this._collection.loadItem(new C(t.primaryKey,t.code,t.value,t.description,t.dateCreate,t.dateUpdate));for(let e of this._collection.sorted)this.ShowBody(e)}ShowBody(e){let t=document.createElement("div");t.className="row",t.dataset.primaryKey=e.primaryKey.toString(),t.addEventListener("click",e=>{this.OnClickRow(e)},!1),t.addEventListener("contextmenu",e=>{this.OnClickRow(e)},!1),t.addEventListener("contextmenu",e=>{this.OnRowContextmenu(e)},!1);let i=document.createElement("div");i.className="cell w3prc cell-horizontal-center cell-vertical-center";let n=document.createElement("input");n.type="checkbox",n.id=e.primaryKey.toString(),i.appendChild(n);let s=document.createElement("label");s.htmlFor=n.id;let d=document.createElement("img");s.appendChild(d),i.appendChild(s);let o=new l(n,d);o.valueRow=e,o.row=t,this._markRows.push(o),t.appendChild(i),i=document.createElement("div"),i.className="cell w10prc",i.textContent=e.code,i.dataset.nameField="code",t.appendChild(i),i=document.createElement("div"),i.className="cell w25prc",i.textContent=e.value,i.dataset.nameField="value",t.appendChild(i),i=document.createElement("div"),i.className="cell w40prc";let r=e.value.length>150?400:200;i.textContent=e.description.length<r?e.description:e.description.slice(0,r)+"…",i.dataset.nameField="description",t.appendChild(i),i=document.createElement("div"),i.className="cell w10prc cell-h-right fsize-0x7rem",i.textContent=a(e.dateCreate),i.dataset.nameField="dateCreate",t.appendChild(i),i=document.createElement("div"),i.className="cell w10prc cell-h-right fsize-0x7rem",i.textContent=a(e.dateUpdate),i.dataset.nameField="dateUpdate",t.appendChild(i),this._tBody.appendChild(t)}UpdatedToShowBody(e){if(this._selected)for(let t of this._selected.children)if(t.dataset.nameField)switch(t.dataset.nameField){case"code":t.textContent=e.code;break;case"value":t.textContent=e.value;break;case"description":let i=e.value.length>150?400:200;t.textContent=e.description.length<i?e.description:e.description.slice(0,i)+"…";break;case"dateUpdate":t.textContent=a(e.dateUpdate)}}OnChangeMarkAllRows(){for(let e of this._markRows)e.checked=this._markAllRows.checked,e.OnChange()}OnChangeMarkRow(){this.ShowGets()}OnClickRow(e){e.target.parentElement.dataset.primaryKey&&(this._selected===e.target.parentElement?"click"===e.type&&(this._selected.dataset.selected="false",this._selected=null):this._selected?(this._selected.dataset.selected="false",this._selected=e.target.parentElement,this._selected.dataset.selected="true"):(this._selected=e.target.parentElement,this._selected.dataset.selected="true"),this.ShowGets())}LoadParams(){let e=new E;for(let t=0;t<localStorage.length;t++)try{let i=JSON.parse(localStorage.key(t)),n=JSON.parse(localStorage.getItem(JSON.stringify(i)));switch(i.parameter){case g.FindIsCreationDate:e.isCreationDate=n.isValue;break;case g.FindIsDateOfChange:e.isDateOfChange=n.isValue;break;case g.FindNoDate:e.noDate=n.isValue;break;case g.FindPeriodFrom:e.periodFrom=new Date(n.dt);break;case g.FindPeriodTo:e.periodTo=new Date(n.dt);break;case g.FindCode:e.code=n.value;break;case g.FindValue:e.value=n.value}}catch(e){}let t=!0;if((e.isCreationDate&&e.isDateOfChange&&e.noDate||!e.isCreationDate&&!e.isDateOfChange&&!e.noDate)&&(e.isCreationDate=!0,e.isDateOfChange=!1,e.noDate=!1,t=!1),null==e.periodFrom){let i=new Date(Date.now());e.periodFrom=new Date(i.getFullYear(),i.getMonth()),t=!1}if(null==e.periodTo){let i=new Date(Date.now());e.periodTo=new Date(i.getFullYear(),i.getMonth()+1),t=!1}null==e.code&&(e.code="",t=!1),null==e.value&&(e.value="",t=!1),t||this.SaveFindParams(e),this._modalFindIsCreationDate.checked=e.isCreationDate,this._modalFindIsDateOfChange.checked=e.isDateOfChange,this._modalFindnoDate.checked=e.noDate,this._modalFindPeriodFrom.value=d(e.periodFrom),this._modalFindPeriodTo.value=d(e.periodTo),this._modalFindCode.value=e.code,this._modalFindValue.value=e.value,w.instance.SetCurrent()}SaveFindParams(e){let t=new I(e.isCreationDate,null,"");localStorage.setItem(JSON.stringify(new O(g.FindIsCreationDate)),JSON.stringify(t)),t.isValue=e.isDateOfChange,localStorage.setItem(JSON.stringify(new O(g.FindIsDateOfChange)),JSON.stringify(t)),t.isValue=e.noDate,localStorage.setItem(JSON.stringify(new O(g.FindNoDate)),JSON.stringify(t)),t.dt=e.periodFrom,localStorage.setItem(JSON.stringify(new O(g.FindPeriodFrom)),JSON.stringify(t)),t.dt=e.periodTo,localStorage.setItem(JSON.stringify(new O(g.FindPeriodTo)),JSON.stringify(t)),t.value=e.code,localStorage.setItem(JSON.stringify(new O(g.FindCode)),JSON.stringify(t)),t.value=e.value,localStorage.setItem(JSON.stringify(new O(g.FindValue)),JSON.stringify(t))}}(document.getElementById("cmdAdd"),document.getElementById("cmdReproduce"),document.getElementById("cmdEdit"),document.getElementById("cmdInfo"),document.getElementById("cmdDel"),document.getElementById("cmdFind"),document.getElementById("cmdClearFind"),document.getElementById("dic-t-heder"),document.getElementById("dic-row-header"),document.getElementById("dic-t-body"),document.getElementById("markAllRows"),document.getElementById("imgMarkAllRows"),document.getElementById("confirm-modal"),document.getElementById("confirmYes"),document.getElementById("confirmNo"),document.getElementById("confirm-modal-Header"),document.getElementById("confirmAbout"),document.getElementById("show-find-parms"),document.getElementById("find-modal"),document.getElementById("creation-date"),document.getElementById("date-of-change"),document.getElementById("noDate"),document.getElementById("findPeriodFrom"),document.getElementById("findPeriodTo"),document.getElementById("findCode"),document.getElementById("findValue"),document.getElementById("findYes"),document.getElementById("findNo"),document.getElementById("edit-modal"),document.getElementById("edit-modal-Header"),document.getElementById("edit-modal-imgMode"),document.getElementById("editCode"),document.getElementById("counterCode"),document.getElementById("editValue"),document.getElementById("counterValue"),document.getElementById("editDescription"),document.getElementById("counterDescription"),document.getElementById("editDateCreate"),document.getElementById("editDateUpdate"),document.getElementById("editYes"),document.getElementById("editNo"),document.getElementById("dicContextMenu"),document.getElementById("cm-Add"),document.getElementById("cm-reproduce"),document.getElementById("cm-edit"),document.getElementById("cm-info"),document.getElementById("cm-del"),document.getElementById("cm-find"),document.getElementById("cm-clear-find"))}]);